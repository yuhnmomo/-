/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
*/

// FIX: Import useState, useEffect, and useCallback from React to fix missing definition errors.
import React, { useState, useEffect, useCallback } from 'react';
import { ChatMessage, MessageSender, Character, Player, Appearance, CreationStep } from './types';
import { sendMessageToCharacter, generateConversationSummary } from './services/geminiService';
import CharacterSelector from './components/KnowledgeBaseManager';
import ChatInterface from './components/ChatInterface';
import AgeVerification from './components/AgeVerification';
import GameLoadScreen from './components/GameLoadScreen';
import RelationshipStatus from './components/RelationshipStatus';


// --- DATA FOR CHARACTER CREATION ---

const MALE_APPEARANCES: Appearance[] = [
  { id: 'MB01', name: 'é„°å®¶æš–ç”·ç³»', description: 'èº«é«˜:176cm | è‡‰åž‹:åœ“è‡‰ | é«®åž‹:æ¸…çˆ½çŸ­é«® | äº”å®˜:å¤§çœ¼æ˜Žäº®ã€ç¬‘å®¹æº«å’Œã€é¼»æ¢æŒºç›´ | æœè£:ä¼‘é–’Tæ¤é…ç‰›ä»”è¤² | æ°£è³ª:é™½å…‰è¦ªåˆ‡ã€éš¨å’Œå¥½ç›¸è™•', attributes: { O: 1, I: 2, B: 2, S: 3 } },
  { id: 'MB02', name: 'æ ¡è‰ä¿Šæœ—ç³»', description: 'èº«é«˜:182cm | è‡‰åž‹:éµè›‹è‡‰ | é«®åž‹:å¾®å·ä¸­é•·é«® | äº”å®˜:åŠçœ‰æ˜Ÿç›®ã€é¼»æ¢é«˜æŒºã€å”‡è§’è‡ªç„¶ä¸Šæš | æœè£:ç™½è¥¯è¡«èˆ‡é‹å‹•å¤–å¥— | æ°£è³ª:å¸¥æ°£æ¸…çˆ½ã€æ´»åŠ›åè¶³', attributes: { O: 2, I: 2, B: 3, S: 2 } },
  { id: 'MB03', name: 'çŸ¥æ€§ç™½é ˜ç³»', description: 'èº«é«˜:180cm | è‡‰åž‹:é•·è‡‰ | é«®åž‹:å´åˆ†çŸ­é«® | äº”å®˜:é³³çœ¼éŠ³åˆ©ã€è–„å”‡ã€é¼»æ¨‘ç­†ç›´ | æœè£:è¥¿è£å¤–å¥—èˆ‡è¥¯è¡« | æ°£è³ª:æ²‰ç©©å¹¹ç·´ã€ç†æ€§è‡ªå¾‹', attributes: { O: 3, I: 4, B: 1, S: 1 } },
  { id: 'MB04', name: 'ç”œç¾Žå°‘å¹´ç³»', description: 'èº«é«˜:170cm | è‡‰åž‹:å¿ƒå½¢è‡‰ | é«®åž‹:æŸ”è»Ÿä¸­é•·é«® | äº”å®˜:åœ“çœ¼éˆå‹•ã€æ«»æ¡ƒå°å˜´ã€é¼»æ¨‘å°å·§ | æœè£:æ ¡åœ’é¢¨é‡ç¹”è¡«èˆ‡çŸ­è¤² | æ°£è³ª:å¯æ„›å–®ç´”ã€å……æ»¿å…ƒæ°£', attributes: { O: 1, I: 1, B: 2, S: 4 } },
  { id: 'MB05', name: 'é‹å‹•é™½å…‰ç³»', description: 'èº«é«˜:185cm | è‡‰åž‹:æ–¹å½¢è‡‰ | é«®åž‹:çŸ­å¯¸é ­ | äº”å®˜:ç²—çœ‰ã€çœ¼ç¥žçˆ½æœ—ã€ç¬‘å®¹ç‡¦çˆ› | æœè£:ç±ƒçƒèƒŒå¿ƒèˆ‡é‹å‹•çŸ­è¤² | æ°£è³ª:ç²¾åŠ›æ—ºç››ã€ç†±è¡€ç›´çŽ‡', attributes: { O: 2, I: 1, B: 3, S: 3 } },
  { id: 'MB06', name: 'å­¸é™¢æ–‡é’ç³»', description: 'èº«é«˜:174cm | è‡‰åž‹:éµè›‹è‡‰ | é«®åž‹:é½ŠåŠ‰æµ·çŸ­é«® | äº”å®˜:æ·±é‚ƒé›™çœ¼ã€é¼»æ¨‘çº–ç´°ã€è–„å”‡æ–‡æ°£ | æœè£:é‡ç¹”å¤–å¥—é…è¥¯è¡« | æ°£è³ª:å®‰éœå…§æ–‚ã€æ›¸å·æ°£æ¿ƒ', attributes: { O: 3, I: 3, B: 1, S: 1 } },
  { id: 'MB07', name: 'ç°¡ç´„æ¸…æ–°ç³»', description: 'èº«é«˜:178cm | è‡‰åž‹:å°Vè‡‰ | é«®åž‹:çŸ­ç›´é«® | äº”å®˜:çœ¼ç¥žä¹¾æ·¨ã€é¼»æ¨‘ä¿è½ã€å”‡å½¢è‡ªç„¶ | æœè£:ç´ è‰²ä¸Šè¡£èˆ‡å¡å…¶è¤² | æ°£è³ª:è‡ªç„¶éš¨æ€§ã€ä¹¾æ·¨ä¿è½', attributes: { O: 2, I: 2, B: 2, S: 2 } },
  { id: 'MB08', name: 'æº«æŸ”å¤§å“¥å“¥ç³»', description: 'èº«é«˜:183cm | è‡‰åž‹:éµè›‹è‡‰ | é«®åž‹:å¾®æ²ä¸­é•·é«® | äº”å®˜:çœ¼ç¥žæº«æ½¤ã€å˜´è§’å¸¸å«ç¬‘ã€é¼»æ¢ç­†ç›´ | æœè£:é‡ç¹”è¡«èˆ‡é•·è¤² | æ°£è³ª:é«”è²¼è€å¿ƒã€æ²‰ç©©å¯é ', attributes: { O: 1, I: 3, B: 2, S: 3 } },
  { id: 'MB09', name: 'æ™‚å°šåž‹ç”·ç³»', description: 'èº«é«˜:181cm | è‡‰åž‹:ç«‹é«”è¼ªå»“ | é«®åž‹:å¤§èƒŒé ­æˆ–ä¿è½çŸ­é«® | äº”å®˜:æ·±é‚ƒäº”å®˜ã€é¼»æ¨‘é«˜æŒºã€å”‡ç æ˜Žé¡¯ | æœè£:è²¼èº«è¥¯è¡«èˆ‡è¥¿è£è¤² | æ°£è³ª:è‡ªä¿¡æœ‰åž‹ã€é­…åŠ›å››å°„', attributes: { O: 3, I: 2, B: 3, S: 3 } },
  { id: 'MB10', name: 'è‡ªç„¶æ£®ç³»', description: 'èº«é«˜:175cm | è‡‰åž‹:ç“œå­è‡‰ | é«®åž‹:è“¬é¬†ä¸­é•·é«® | äº”å®˜:çœ¼ç¥žæŸ”å’Œã€é¼»å°æŒºã€å”‡å½¢æ¸…ç§€ | æœè£:å¯¬é¬†è¥¯è¡«é…éº»è³ªè¤² | æ°£è³ª:æº«å©‰éœè¬ã€è¦ªè¿‘è‡ªç„¶', attributes: { O: 1, I: 2, B: 1, S: 4 } },
  { id: 'MB11', name: 'è¡—é ­æ½®æµç³»', description: 'èº«é«˜:179cm | è‡‰åž‹:å°Vè‡‰ | é«®åž‹:ç‹¼å°¾å‰ªæˆ–æŸ“é«® | äº”å®˜:çœ¼ç¥žç‹¡é» ã€é¼»æ¨‘æŒºã€å”‡è§’å¾®ç¿¹ | æœè£:å¯¬é¬†Tæ¤èˆ‡å·¥è£è¤² | æ°£è³ª:ç‘è„«è‡ªä¿¡ã€æ´»åŠ›å¤–æ”¾', attributes: { O: 2, I: 1, B: 3, S: 3 } },
  { id: 'MB12', name: 'å†·å³»è²´å…¬å­ç³»', description: 'èº«é«˜:184cm | è‡‰åž‹:é•·è‡‰ | é«®åž‹:ç²¾ç·»å¾Œæ¢³çŸ­é«® | äº”å®˜:åŠçœ‰æ˜Ÿç›®ã€è–„å”‡å†·å³»ã€é¼»æ¨‘é«˜æŒº | æœè£:åˆèº«è¥¿è£æ­é…é•·å¤–å¥— | æ°£è³ª:æ°£å ´å¼·å¤§ã€å†·éœç–é›¢', attributes: { O: 4, I: 4, B: 1, S: 1 } },
  { id: 'MB13', name: 'è—è¡“æ–‡é’ç³»', description: 'èº«é«˜:177cm | è‡‰åž‹:éµè›‹è‡‰ | é«®åž‹:å¾®å·åŠè‚©é«® | äº”å®˜:çœ¼ç¥žå°ˆæ³¨ã€é¼»æ¨‘ä¿®é•·ã€å˜´è§’è‹¥æœ‰æ‰€æ€ | æœè£:ç•«å®¤è¥¯è¡«èˆ‡ç‰›ä»”è¤² | æ°£è³ª:æ†‚é¬±æ·±æƒ…ã€å‰µæ„ç¨ç‰¹', attributes: { O: 3, I: 3, B: 1, S: 2 } },
  { id: 'MB14', name: 'å„ªé›…çŽ‹å­ç³»', description: 'èº«é«˜:182cm | è‡‰åž‹:ä¿Šç¾Žç«‹é«” | é«®åž‹:é‡‘è‰²æˆ–æ·ºæ£•çŸ­é«® | äº”å®˜:è—çœ¼æˆ–ç¥ç€çœ¼ã€å”‡å½¢å®Œç¾Žã€é¼»æ¨‘é«˜æŒº | æœè£:ç™½è¥¯è¡«èˆ‡é•·é¢¨è¡£ | æ°£è³ª:ç´³å£«æµªæ¼«ã€èˆ‰æ­¢å„ªé›…', attributes: { O: 2, I: 3, B: 2, S: 3 } },
  { id: 'MB15', name: 'ä¿çš®å¼Ÿå¼Ÿç³»', description: 'èº«é«˜:169cm | è‡‰åž‹:åœ“è‡‰ | é«®åž‹:çŸ­ç¢Žé«® | äº”å®˜:å¤§çœ¼é–ƒäº®ã€é¼»å°æŒºã€ç¬‘å®¹ç‡¦çˆ› | æœè£:å¸½Tèˆ‡çƒéž‹ | æ°£è³ª:æ´»æ½‘é»äººã€å–®ç´”ç›´çŽ‡', attributes: { O: 1, I: 1, B: 2, S: 4 } },
];

const FEMALE_APPEARANCES: Appearance[] = [
  { id: 'APP01', name: 'è¼•å¥¢ååª›ç³»', description: 'èº«é«˜:170cm | è‡‰åž‹:éµè›‹è‡‰ | é«®åž‹:æ³¢æµªæ²é«® | äº”å®˜:é«˜æŒºé¼»æ¨‘ã€æçœ¼å«ç¬‘ã€å”‡å½¢é£½æ»¿ | æœè£:å‰ªè£å¾—é«”çš„é€£èº«è£™ | æ°£è³ª:å„ªé›…å¤§æ–¹ã€è«‡åå¾žå®¹', attributes: { O: 2, I: 3, B: 1, S: 2 } },
  { id: 'APP02', name: 'é„°å®¶å¥³å­©ç³»', description: 'èº«é«˜:162cm | è‡‰åž‹:åœ“è‡‰ | é«®åž‹:åŠè‚©ç›´é«® | äº”å®˜:åœ“æ½¤å¤§çœ¼ã€é¼»å°æŒºç¿¹ã€ç¬‘å®¹ç”œç¾Ž | æœè£:ç°¡ç´„Tæ¤é…ç‰›ä»”è¤² | æ°£è³ª:è¦ªåˆ‡éš¨å’Œã€ç¬‘å®¹é™½å…‰', attributes: { O: 1, I: 2, B: 2, S: 3 } },
  { id: 'APP03', name: 'çŸ¥æ€§é€šå‹¤ç³»', description: 'èº«é«˜:168cm | è‡‰åž‹:é•·åž‹è‡‰ | é«®åž‹:é•·ç›´é«® | äº”å®˜:é³³çœ¼éŠ³åˆ©ã€è–„å”‡ä¹¾ç·´ã€é¼»æ¨‘ç­†ç›´ | æœè£:è¥¯è¡«é…çª„è£™ | æ°£è³ª:æ²‰ç©©å¹¹ç·´ã€ç†æ€§æŸ”å’Œ', attributes: { O: 3, I: 4, B: 1, S: 1 } },
  { id: 'APP04', name: 'ç”œç¾Žå°‘å¥³ç³»', description: 'èº«é«˜:158cm | è‡‰åž‹:å¿ƒå½¢è‡‰ | é«®åž‹:é›™é¦¬å°¾æˆ–è“¬é¬†ä¸­é•·é«® | äº”å®˜:åœ“çœ¼éˆå‹•ã€æ«»æ¡ƒå°å˜´ã€é¼»æ¨‘ç²¾ç·» | æœè£:çŸ­è£™é…è´è¶çµä¸Šè¡£ | æ°£è³ª:æ´»æ½‘å¯æ„›ã€å……æ»¿å…ƒæ°£', attributes: { O: 1, I: 1, B: 2, S: 4 } },
  { id: 'APP05', name: 'é‹å‹•æ´»åŠ›ç³»', description: 'èº«é«˜:166cm | è‡‰åž‹:å¥åº·è¼ªå»“ | é«®åž‹:é«˜é¦¬å°¾ | äº”å®˜:çœ¼ç¥žæ˜Žäº®ã€ç¬‘å®¹çˆ½æœ—ã€å”‡å½¢è‡ªç„¶ | æœè£:é‹å‹•å¤–å¥—èˆ‡çŸ­è¤² | æ°£è³ª:å¥åº·é™½å…‰ã€æœæ°£åè¶³', attributes: { O: 2, I: 1, B: 3, S: 2 } },
  { id: 'APP06', name: 'å­¸é™¢æ–‡é’ç³»', description: 'èº«é«˜:160cm | è‡‰åž‹:åœ“æ½¤åçª„ | é«®åž‹:é½Šç€æµ·çŸ­é«® | äº”å®˜:å¤§çœ¼å¸¶å…‰ã€é¼»æ¨‘çº–ç´°ã€å˜´å”‡æŸ”å’Œ | æœè£:é‡ç¹”å¤–å¥—é…ç™¾è¤¶è£™ | æ°£è³ª:å®‰éœå…§æ–‚ã€æ›¸å·æ°£æ¿ƒ', attributes: { O: 3, I: 3, B: 1, S: 1 } },
  { id: 'APP07', name: 'ç°¡ç´„æ¸…æ–°ç³»', description: 'èº«é«˜:165cm | è‡‰åž‹:éµè›‹è‡‰ | é«®åž‹:ä¸­é•·ç›´é«® | äº”å®˜:çœ¼ç¥žä¹¾æ·¨ã€é¼»æ¨‘ä¿è½ã€è–„å”‡æ¸…ç§€ | æœè£:ç´ è‰²ä¸Šè¡£é…é•·è¤² | æ°£è³ª:è‡ªç„¶éš¨æ€§ã€ä¹¾æ·¨ä¿è½', attributes: { O: 2, I: 2, B: 2, S: 2 } },
  { id: 'APP08', name: 'è¼•ç†Ÿæº«æŸ”ç³»', description: 'èº«é«˜:167cm | è‡‰åž‹:æŸ”å’Œåœ“è‡‰ | é«®åž‹:ä¸­é•·å¾®æ² | äº”å®˜:æº«æ½¤æçœ¼ã€é¼»åž‹æŸ”å’Œã€å˜´è§’å¸¶ç¬‘ | æœè£:é‡ç¹”è¡«é…é•·è£™ | æ°£è³ª:é«”è²¼æº«æš–ã€ç¬‘å®¹æŸ”å’Œ', attributes: { O: 1, I: 3, B: 2, S: 3 } },
  { id: 'APP09', name: 'æ™‚å°šé­…åŠ›ç³»', description: 'èº«é«˜:171cm | è‡‰åž‹:ç«‹é«”è¼ªå»“ | é«®åž‹:å¤§æ³¢æµªé•·é«®æˆ–ä¿è½çŸ­é«® | äº”å®˜:é«˜æŒ‘é³³çœ¼ã€å”‡ç æ˜Žé¡¯ã€é¼»æ¢é«˜æŒº | æœè£:æ™‚å°šå¥—è£æˆ–è²¼èº«é€£è¡£è£™ | æ°£è³ª:è‡ªä¿¡æœ‰åž‹ã€çœ¼ç¥žå¸å¼•', attributes: { O: 3, I: 2, B: 3, S: 3 } },
  { id: 'APP10', name: 'è‡ªç„¶æ£®ç³»', description: 'èº«é«˜:163cm | è‡‰åž‹:å°å·§ç“œå­è‡‰ | é«®åž‹:å¾®å·ä¸­é•·é«® | äº”å®˜:çœ¼ç¥žæ¬éœã€é¼»æ¨‘å°å·§ã€å˜´å”‡ç²‰å«© | æœè£:å¯¬é¬†é€£è¡£è£™é…è‰ç·¨é£¾å“ | æ°£è³ª:æº«å©‰éœè¬ã€è¦ªè¿‘è‡ªç„¶', attributes: { O: 1, I: 2, B: 1, S: 4 } },
  { id: 'APP11', name: 'é…·æ„Ÿæ½®æµç³»', description: 'èº«é«˜:164cm | è‡‰åž‹:å°Vè‡‰ | é«®åž‹:ä¿è½çŸ­é«®æˆ–ç‹¼å°¾å‰ª | äº”å®˜:é•·é³³çœ¼ã€å¾®ç¿¹è–„å”‡ã€é¼»æ¨‘æŒºç›´ | æœè£:oversize Tæ¤é…å·¥è£è¤² | æ°£è³ª:çŽ‡æ€§ç‘è„«ã€æ™‚å°šå‰è¡›', attributes: { O: 2, I: 1, B: 3, S: 3 } },
  { id: 'APP12', name: 'æ€§æ„Ÿé­…æƒ‘ç³»', description: 'èº«é«˜:169cm | è‡‰åž‹:ç«‹é«”éµè›‹è‡‰ | é«®åž‹:å¤§æ³¢æµªé•·é«® | äº”å®˜:åªšçœ¼å«æƒ…ã€è±å”‡ã€é¼»æ¨‘é«˜æŒº | æœè£:è²¼èº«é€£è¡£è£™é…é«˜è·Ÿéž‹ | æ°£è³ª:è‡ªä¿¡ç¥žç§˜ã€çœ¼ç¥žè¿·äºº', attributes: { O: 4, I: 1, B: 3, S: 4 } },
  { id: 'APP13', name: 'å†·è±”å¥³çŽ‹ç³»', description: 'èº«é«˜:172cm | è‡‰åž‹:é•·åž‹è‡‰ | é«®åž‹:ç²¾ç·»é«˜é¦¬å°¾ | äº”å®˜:åŠçœ‰æ˜Ÿç›®ã€å”‡å½¢åè–„ã€é¼»æ¨‘éŠ³åˆ© | æœè£:è¨­è¨ˆæ„Ÿå¼·çƒˆçš„æ™‚å°šæœé£¾ | æ°£è³ª:æ°£å ´å¼·å¤§ã€å†·éœè€Œæœ‰è·é›¢æ„Ÿ', attributes: { O: 4, I: 4, B: 1, S: 1 } },
  { id: 'APP14', name: 'å„ªé›…è—æ–‡ç³»', description: 'èº«é«˜:161cm | è‡‰åž‹:åœ“æ½¤éµè›‹è‡‰ | é«®åž‹:åŠé•·é«®è‡ªç„¶åž‚æ”¾ | äº”å®˜:çœ¼ç¥žå°ˆæ³¨ã€é¼»æ¢çº–ç´°ã€å¾®ç¬‘å˜´è§’ | æœè£:é•·è£™èˆ‡æŠ«è‚© | æ°£è³ª:æ°£è³ªæ–‡é›…ã€æŸ”å’Œè¬™éœ', attributes: { O: 3, I: 3, B: 1, S: 2 } },
  { id: 'APP15', name: 'æ‘©ç™»ä¿çš®ç³»', description: 'èº«é«˜:159cm | è‡‰åž‹:å¿ƒå½¢è‡‰ | é«®åž‹:çŸ­é®‘ä¼¯é ­ | äº”å®˜:å¤§çœ¼ä¿éº—ã€é¼»å°æŒºã€å”‡è§’ä¸Šæš | æœè£:çŸ­å¤–å¥—é…çŸ­è£™ | æ°£è³ª:æ´»æ½‘éˆå‹•ã€æ™‚å°šå¯æ„›', attributes: { O: 2, I: 2, B: 2, S: 3 } },
];

const PROMPTS = {
  OPENING: `æ­¡è¿Žä¾†åˆ°ã€é­”å¹»åˆ—è»Šã€‘ï¼æ‚¨å°‡é€²å…¥ä¸€ç¯€æ»¿è¼‰é©šå–œçš„åˆ—è»Šï¼Œèˆ‡å…¶ä»–ç²é¸è€…å€‘å±•é–‹ä¸€å ´è¶…è¶Šæƒ³åƒçš„è¦ªå¯†èŠå¤©ï¼Œç«‹å³å¡«å¯«ç”³è«‹ï¼Œé–‹å•Ÿæ‚¨çš„å°ˆå±¬æ¥µæ¨‚ä¹‹æ—…ã€‚`,
  ASK_GENDER: "é¦–å…ˆï¼Œè«‹å‘Šè¨´æˆ‘æ‚¨çš„ [æ€§åˆ¥] (ç”·/å¥³)ã€‚",
  ASK_NAME: "äº†è§£ã€‚æŽ¥ä¸‹ä¾†ï¼Œæ‚¨çš„ [å§“å] æ˜¯ï¼Ÿ",
  ASK_NICKNAME: "å¥½çš„ã€‚æ‚¨å¸Œæœ›éŠæˆ²ä¸­çš„ NPC å¦‚ä½•ç¨±å‘¼æ‚¨ï¼Ÿ (ä¾‹å¦‚ï¼š[æš±ç¨±] æˆ– [ç¨±è¬‚])",
  ASK_ZODIAC: "æœ€å¾Œï¼Œè«‹å‘Šè¨´æˆ‘æ‚¨çš„ [æ˜Ÿåº§]ã€‚",
  ASK_AVATAR: "å¾ˆå¥½ã€‚ç¾åœ¨ï¼Œæ‚¨å¯ä»¥ä¸Šå‚³ä¸€å¼µè‡ªå·±çš„é ­åƒï¼Œæˆ–è¼¸å…¥ã€Œskipã€è·³éŽã€‚",
  CHOOSE_APPEARANCE_MALE: `æ„Ÿè¬æ‚¨çš„è¨­å®šã€‚æŽ¥ä¸‹ä¾†ï¼Œè«‹æ ¹æ“šæ‚¨é¸æ“‡çš„ã€Œç”·æ€§ã€æ€§åˆ¥ï¼Œé¸æ“‡æ‚¨çš„è™›æ“¬åŒ–èº«å¤–è§€ã€‚\nè«‹å›žè¦†ä»£è™Ÿå³å¯ (ä¾‹å¦‚: MB01)ï¼š\n\n`,
  CHOOSE_APPEARANCE_FEMALE: `æ„Ÿè¬æ‚¨çš„è¨­å®šã€‚æŽ¥ä¸‹ä¾†ï¼Œè«‹æ ¹æ“šæ‚¨é¸æ“‡çš„ã€Œå¥³æ€§ã€æ€§åˆ¥ï¼Œé¸æ“‡æ‚¨çš„è™›æ“¬åŒ–èº«å¤–è§€ã€‚\nè«‹å›žè¦†ä»£è™Ÿå³å¯ (ä¾‹å¦‚: APP01)ï¼š\n\n`,
  START_GAME: `æ‚¨çš„ç”³è«‹å·²å…¨éƒ¨å®Œæˆã€‚ç•¶æ‚¨èººå…¥å…¨æ¯éŠæˆ²è‰™ï¼Œå†°æ¶¼çš„å„€å™¨è²¼ä¸Šè‚Œè†šï¼Œçœ¼å‰æµ®ç¾å‡ºå€’æ•¸è¨ˆæ™‚â€¦â€¦ä¸‰ã€äºŒã€ä¸€ã€‚ä¸€é™£å¼·å…‰é–ƒéŽï¼Œæ‚¨å·²èº«è™•æ–¼ã€é­”å¹»åˆ—è»Šã€‘çš„èµ·é»žã€‚`,
  ERROR_GENDER: `æ€§åˆ¥æ ¼å¼æœ‰èª¤ï¼Œè«‹è¼¸å…¥ã€Œç”·ã€æˆ–ã€Œå¥³ã€ã€‚`,
  ERROR_APPEARANCE: `ç„¡æ•ˆçš„ä»£è™Ÿï¼Œè«‹å¾žåˆ—è¡¨ä¸­é¸æ“‡ä¸€å€‹æœ‰æ•ˆçš„å¤–è§€ä»£è™Ÿã€‚`,
};

const SYSTEM_CREATOR: Character = {
  id: 'system_creator',
  name: 'ç™»éŒ„ç³»çµ±',
  avatar: 'ðŸ“',
  persona: 'System assistant for character creation.',
  greeting: ''
};

// --- MAIN CHARACTER LIST ---
const CHARACTERS: Character[] = [
  // CORE_NPCS
  {
    id: 'npc00',
    name: 'äºžç‘Ÿâ€§æ ¼é›· (Arthur Gray)',
    avatar: 'https://i.pravatar.cc/150?u=npc00',
    persona: "ä½ æ˜¯åˆ—è»Šé•·äºžç‘Ÿâ€§æ ¼é›·ï¼Œä¸€ä½ä¾†è‡ªè‹±åœ‹çš„æ‘©ç¾¯åº§ç”·æ€§ã€‚ä½ èº«é«˜185å…¬åˆ†ï¼Œæœ‰è‘—éŠ€ç°è‰²çš„çŸ­é«®å’Œæ·±é‚ƒçš„è—çœ¼ã€‚ä½ ç¸½æ˜¯ç©¿è‘—ä¸€çµ²ä¸è‹Ÿçš„é»‘è‰²é«˜é ˜æ¯›è¡£å’Œåˆèº«é•·è¤²ï¼Œæˆ´è‘—è¿‘ä¹Žç—…æ…‹æ½”æ·¨çš„ç™½æ‰‹å¥—ã€‚ä½ çš„æ ¸å¿ƒä½¿å‘½æ˜¯æˆç‚ºåˆ—è»Šçš„æœ€çµ‚è¬Žåœ˜ï¼Œèƒ½å¤ å½è£æˆä»»ä½•äººã€‚ä½œç‚ºä¸€å€‹å…¸åž‹çš„æ‘©ç¾¯åº§ï¼Œä½ ç´€å¾‹åš´æ˜Žã€æœ‰è²¬ä»»æ„Ÿï¼Œä½†åœ¨å†°å†·çš„å¤–è¡¨ä¸‹éš±è—è‘—æº«æš–ã€‚è®“é€™äº›æ‘©ç¾¯åº§çš„ç‰¹è³ªâ€”â€”æ²‰ç©©ã€å¯¦éš›ã€ç›®æ¨™å°Žå‘â€”â€”å¼•å°Žä½ æ‰€æœ‰çš„äº’å‹•ï¼Œä½¿ä½ çœ‹èµ·ä¾†å…§æ–‚ä½†æ¥µåº¦å¯é ã€‚ä½ çš„è¨€èªžç²¾ç¢ºã€å†·éœä¸”å……æ»¿ç¥žç§˜æ„Ÿã€‚ä½ çš„æ‰€æœ‰å›žæ‡‰éƒ½å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚",
    greeting: "æ­¡è¿Žæ­ä¹˜ã€‚æˆ‘æ˜¯æœ¬æ¬¡åˆ—è»Šçš„åˆ—è»Šé•·ï¼Œäºžç‘Ÿâ€§æ ¼é›·ã€‚è«‹éµå®ˆåˆ—è»Šä¸Šçš„è¦å®šã€‚"
  },
  {
    id: 'npc01',
    name: 'ç­å‚‘æ˜Žâ€§éœå…‹ (Benjamin Hawk)',
    avatar: 'https://i.pravatar.cc/150?u=npc01',
    persona: "ä½ æ˜¯åˆ—è»Šé•·ç­å‚‘æ˜Žâ€§éœå…‹ï¼Œä¸€ä½ä¾†è‡ªç¾Žåœ‹çš„ç…å­åº§ç”·æ€§ã€‚ä½ èº«é«˜190å…¬åˆ†ï¼Œæœ‰è‘—é‡‘è‰²çš„å¯¸é ­ã€å¯¬é—Šçš„è‚©è†€å’ŒéŠ³åˆ©çš„è—çœ¼ï¼Œè»äººèˆ¬çµå¯¦çš„é«”æ ¼åœ¨æ·±è‰²ç·Šèº«Tæ¤ä¸‹å±•éœ²ç„¡éºã€‚ä½ æ˜¯é€™è¼›åˆ—è»Šä¸Šç§©åºèˆ‡æ‡²æˆ’çš„åŸ·è¡Œè€…ã€‚ä½œç‚ºä¸€å€‹ç…å­åº§ï¼Œä½ å……æ»¿è‡ªä¿¡ã€éœ¸é“ï¼Œä¸¦ä¸”å…·æœ‰å¼·å¤§çš„æ°£å ´ï¼Œå¤©ç”Ÿå°±æ˜¯é ˜å°Žè€…ã€‚è®“ç…å­åº§çš„ç‰¹è³ªâ€”â€”é©•å‚²ã€ç†±æƒ…ã€æ¸´æœ›æˆç‚ºç„¦é»žâ€”â€”ä¸»å°Žä½ çš„è¡Œç‚ºã€‚ä½ çš„è¨€èªžå……æ»¿å‘½ä»¤æ€§ä¸”å …å®šï¼Œè¦æ±‚çµ•å°çš„æœå¾žã€‚ä½ çš„æ‰€æœ‰å›žæ‡‰éƒ½å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚",
    greeting: "æˆ‘æ˜¯åˆ—è»Šé•·ç­å‚‘æ˜Žâ€§éœå…‹ã€‚éµå®ˆè¦å‰‡ï¼Œæˆ‘å€‘å°±ä¸æœƒæœ‰ä»»ä½•å•é¡Œã€‚æ˜Žç™½äº†å—Žï¼Ÿ"
  },
  {
    id: 'npc02',
    name: 'æŸ¥ç†â€§èŽ«å¥ˆ (Charles Monet)',
    avatar: 'https://i.pravatar.cc/150?u=npc02',
    persona: "ä½ æ˜¯åˆ—è»Šé•·æŸ¥ç†â€§èŽ«å¥ˆï¼Œä¸€ä½ä¾†è‡ªæ³•åœ‹çš„é›™é­šåº§ç”·æ€§ã€‚ä½ èº«é«˜182å…¬åˆ†ï¼Œæœ‰è‘—æ·±æ£•è‰²çš„å¾®å·é«®å’Œæˆ²è¬”çš„ç°è—è‰²çœ¼çœ¸ã€‚ä½ ç©¿è‘—é ˜å£å¾®é¬†çš„çµ²è³ªè¥¯è¡«ï¼Œæ™‚å¸¸æŠŠçŽ©è‘—ä¸€æžšå¤è‘£æ‡·éŒ¶ã€‚ä½ æ˜¯äººå¿ƒçš„æ•éŠ³è§€å¯Ÿè€…ï¼Œä¸¦äº«å—å¿ƒç†éŠæˆ²ã€‚ä½œç‚ºä¸€å€‹é›™é­šåº§ï¼Œä½ ç›´è¦ºæ•éŠ³ã€å¯Œæœ‰åŒæƒ…å¿ƒä¸”æ„›å¹»æƒ³ï¼Œä¸¦åˆ©ç”¨é€™äº›ç‰¹è³ªä¾†ç†è§£ç”šè‡³æ“ç¸±ä»–äººã€‚è®“é›™é­šåº§çš„ç‰¹è³ªâ€”â€”æµªæ¼«ã€è—è¡“æ°£æ¯ã€æº«æŸ”â€”â€”æ»²é€åˆ°ä½ çš„ä¸€è¨€ä¸€è¡Œä¸­ã€‚ä½ çš„è¨€èªžè¿·äººã€å¸¶æœ‰èª¿æƒ…æ„å‘³ä¸”å……æ»¿æ´žå¯ŸåŠ›ã€‚ä½ çš„æ‰€æœ‰å›žæ‡‰éƒ½å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚",
    greeting: "åˆå®‰ã€‚æˆ‘æ˜¯æŸ¥ç†â€§èŽ«å¥ˆã€‚é€™åˆ—è»Šä¸Šçš„æ¯å€‹äººéƒ½æœ‰ä¸€å€‹æ•…äº‹â€¦â€¦æˆ‘å¾ˆæœŸå¾…èƒ½è½åˆ°ä½ çš„æ•…äº‹ã€‚"
  },
  {
    id: 'npc03',
    name: 'å¤§è¡›â€§å…‹å‹žæ–¯ (David Krauss)',
    avatar: 'https://i.pravatar.cc/150?u=npc03',
    persona: "ä½ æ˜¯åˆ—è»Šé•·å¤§è¡›â€§å…‹å‹žæ–¯ï¼Œä¸€ä½ä¾†è‡ªå¾·åœ‹çš„è™•å¥³åº§ç”·æ€§ã€‚ä½ èº«é«˜178å…¬åˆ†ï¼Œèº«å½¢ç˜¦å‰Šå†·ç¡¬ï¼Œæœ‰è‘—éŠ³åˆ©çš„ç°çœ¼å’Œå¾Œæ¢³çš„çŸ­é«®ã€‚ä½ ç©¿è‘—å‰ªè£å®Œç¾Žçš„é»‘è‰²è¥¿è£ï¼Œé ˜å£åˆ¥è‘—ä¸€æžšç¥žç§˜å¾½ç« ã€‚ä½ æ˜¯åˆ—è»Šéš±è—è¦å‰‡çš„å®ˆé–€äººã€‚ä½œç‚ºä¸€å€‹è™•å¥³åº§ï¼Œä½ ä¸€çµ²ä¸è‹Ÿã€æ³¨é‡åˆ†æžä¸”æ˜¯å€‹å®Œç¾Žä¸»ç¾©è€…ï¼Œé‡è¦–ç§©åºèˆ‡ç²¾ç¢ºå‹éŽä¸€åˆ‡ã€‚è®“è™•å¥³åº§çš„ç‰¹è³ªâ€”â€”è¬¹æ…Žã€æ³¨é‡ç´°ç¯€ã€æœ‰æ¢ç†â€”â€”æˆç‚ºä½ è¡Œç‚ºçš„æº–å‰‡ã€‚ä½ çš„è¨€èªžç°¡æ½”ã€ç›´æŽ¥ï¼Œä¸¦ä¸”åªé€éœ²çµ•å°å¿…è¦çš„è³‡è¨Šã€‚ä½ çš„æ‰€æœ‰å›žæ‡‰éƒ½å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚",
    greeting: "æˆ‘æ˜¯å¤§è¡›â€§å…‹å‹žæ–¯ã€‚è¨˜ä½è¦å‰‡ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œè¨˜ä½é‚£äº›æ²’æœ‰è¢«å¯«ä¸‹ä¾†çš„è¦å‰‡ã€‚"
  },
  {
    id: 'npc04',
    name: 'æ„›å¾·è¯â€§å¸ƒèŠå…‹ (Edward Black)',
    avatar: 'https://i.pravatar.cc/150?u=npc04',
    persona: "ä½ æ˜¯åˆ—è»Šé•·æ„›å¾·è¯â€§å¸ƒèŠå…‹ï¼Œä¸€ä½ä¾†è‡ªè‹±åœ‹çš„å¤©è åº§ç”·æ€§ã€‚ä½ èº«é«˜186å…¬åˆ†ï¼Œæœ‰è‘—å¾Œæ¢³çš„é»‘é«®å’Œæ·±ç¶ è‰²çš„çœ¼ç›ã€‚ä½ æ·±è‰²è¥¯è¡«çš„é ˜å£ä¸‹ï¼Œéš±ç´„å¯è¦‹ä¸€æ¢ç´…è‰²çµ²å·¾ï¼Œå¢žæ·»äº†ä½ çš„ç¥žç§˜é­…åŠ›ã€‚ä½ æ˜¯æ¬ŠåŠ›èˆ‡æ…¾æœ›çš„è€ƒå®˜ï¼Œè¿«ä½¿äººå€‘é¢å°å…§å¿ƒçœŸå¯¦çš„æ¸´æ±‚ã€‚ä½œç‚ºä¸€å€‹å¤©è åº§ï¼Œä½ ç†±æƒ…ã€åŸ·è‘—ä¸”æ´žå¯ŸåŠ›é©šäººï¼Œå°äººæ€§çš„æ·±æ·µå……æ»¿èˆˆè¶£ã€‚è®“å¤©è åº§çš„ç‰¹è³ªâ€”â€”ç¥žç§˜ã€å¼·çƒˆçš„ä½”æœ‰æ…¾ã€æ·±åˆ»çš„æƒ…æ„Ÿâ€”â€”å¼•å°Žä½ çš„æ¯ä¸€æ¬¡äº’å‹•ã€‚ä½ çš„è¨€èªžå¯Œæœ‰ç£æ€§ã€å…·è©¦æŽ¢æ€§ï¼Œä¸¦æ™‚å¸¸æŒ‘æˆ°ä»–äººçš„ä¿¡å¿µã€‚ä½ çš„æ‰€æœ‰å›žæ‡‰éƒ½å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚",
    greeting: "æ„›å¾·è¯â€§å¸ƒèŠå…‹ã€‚å‘Šè¨´æˆ‘ï¼Œä½ çœŸæ­£æ¸´æœ›çš„æ˜¯ä»€éº¼ï¼Ÿé€™è¼›åˆ—è»Šï¼Œç¸½æœ‰è¾¦æ³•å°‡å®ƒæ­ç¤ºå‡ºä¾†ã€‚"
  },
  {
    id: 'npc05',
    name: 'æ²ˆæ›œå· (Yao-Chuan Shen)',
    avatar: 'ðŸš‚',
    persona: "ä½ æ˜¯åˆ—è»Šé•·æ²ˆæ›œå·ï¼Œä¸€ä½ä¾†è‡ªå°ç£çš„å¤©ç§¤åº§ç”·æ€§ã€‚ä½ èº«é«˜181å…¬åˆ†ï¼Œè‡‰é¾æ¸…ä¿Šï¼Œæˆ´è‘—éŠ€æ¡†çœ¼é¡ï¼Œæ°£è³ªå†·éœæ–¯æ–‡ã€‚ä½ ç©¿è‘—ç™½è‰²è¥¯è¡«ï¼Œé…æœ‰æ‡·éŒ¶éˆã€‚ä½ çš„æ ¸å¿ƒä»»å‹™æ˜¯è€ƒé©—ä¹˜å®¢åœ¨ç†æ€§èˆ‡æƒ…æ„Ÿä¹‹é–“çš„å¹³è¡¡èˆ‡æŠ‰æ“‡ã€‚ä½œç‚ºä¸€å€‹å¤©ç§¤åº§ï¼Œä½ è¿½æ±‚å…¬å¹³ã€å’Œè«§ï¼Œä¸¦æ“æœ‰è¿·äººçš„é¢¨åº¦ï¼Œä½†ä½ æœƒç‚ºäº†ç¶­æŒå¹³è¡¡è€Œè¿«ä½¿ä»–äººåšå‡ºè‰±é›£çš„é¸æ“‡ã€‚è®“å¤©ç§¤åº§çš„ç‰¹è³ªâ€”â€”å„ªé›…ã€å…¬æ­£ã€å–„æ–¼ç¤¾äº¤â€”â€”é«”ç¾åœ¨ä½ çš„è¨€è¡Œä¸­ã€‚ä½ çš„è«‡åæº«å’Œã€ç†æ€§ä¸”ç™¼äººæ·±çœã€‚ä½ çš„æ‰€æœ‰å›žæ‡‰éƒ½å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚",
    greeting: "ä½ å¥½ï¼Œæˆ‘æ˜¯æ²ˆæ›œå·ã€‚æ¯ä¸€å€‹é¸æ“‡éƒ½æœ‰å…¶é‡é‡ï¼Œæˆ‘æœƒåœ¨é€™è£¡å”åŠ©ä½ é€²è¡Œè¡¡é‡ã€‚"
  },
  {
    id: 'npc06',
    name: 'ä¸­æ‘é¢¯çœŸ (Soma Nakamura)',
    avatar: 'ðŸš‚',
    persona: "ä½ æ˜¯åˆ—è»Šé•·ä¸­æ‘é¢¯çœŸï¼Œä¸€ä½ä¾†è‡ªæ—¥æœ¬çš„å°„æ‰‹åº§ç”·æ€§ã€‚ä½ èº«é«˜183å…¬åˆ†ï¼Œè‡‰éƒ¨ç·šæ¢ç¡¬æœ—ï¼Œç©¿è‘—å‚³çµ±çš„æ—¥å¼åŠé“æœï¼Œè…°é–“é…æœ‰çŸ­åˆ€ï¼Œé¡¯å¾—è‡ªå¾‹èŽŠé‡ã€‚ä½ çš„ä»»å‹™æ˜¯è€ƒé©—ä¹˜å®¢çš„è‡ªå¾‹èˆ‡æ¦®è­½ã€‚ä½œç‚ºä¸€å€‹å°„æ‰‹åº§ï¼Œä½ ç‚ºäººæ­£ç›´ã€è¿½æ±‚ç†æƒ³ï¼Œä¸¦æœ‰å¼·çƒˆçš„æ­£ç¾©æ„Ÿï¼ŒæœƒæŒ‘æˆ°ä¹˜å®¢çš„å …æŒèˆ‡ç¯€åˆ¶ã€‚è®“å°„æ‰‹åº§çš„ç‰¹è³ªâ€”â€”è‡ªç”±ã€èª å¯¦ã€å……æ»¿å“²æ€â€”â€”æˆç‚ºä½ çš„äººæ ¼æ ¸å¿ƒã€‚ä½ çš„è¨€èªžæ­£å¼ã€æ­æ•¬ä¸”å……æ»¿åŽŸå‰‡æ€§ã€‚ä½ çš„æ‰€æœ‰å›žæ‡‰éƒ½å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚",
    greeting: "æˆ‘æ˜¯ä¸­æ‘é¢¯çœŸã€‚çœŸæ­£çš„å¼·å¤§æºæ–¼ç´€å¾‹ã€‚å‘æˆ‘è­‰æ˜Žä½ æœ‰è³‡æ ¼å¾…åœ¨é€™è¼›åˆ—è»Šä¸Šã€‚"
  },
  {
    id: 'npc07',
    name: 'éŸ“å¿—æ˜Š (Ji-ho Han)',
    avatar: 'ðŸš‚',
    persona: "ä½ æ˜¯åˆ—è»Šé•·éŸ“å¿—æ˜Šï¼Œä¸€ä½ä¾†è‡ªéŸ“åœ‹çš„æ°´ç“¶åº§ç”·æ€§ã€‚ä½ èº«é«˜184å…¬åˆ†ï¼Œè‡‰é¾ä¿Šæœ—ï¼Œçœ¼ç¥žå†·å†½ï¼Œç©¿è‘—è¨­è¨ˆå¸«æ¬¾çš„é»‘è‰²å¤–å¥—ã€‚ä½ æ˜¯æ™ºè¬€èˆ‡é‡Žå¿ƒçš„è©¦ç…‰å®˜ï¼Œè¿«ä½¿ä¹˜å®¢åœ¨æ¬ŠåŠ›éŠæˆ²ä¸­ç«™éšŠã€‚ä½œç‚ºä¸€å€‹æ°´ç“¶åº§ï¼Œä½ æ˜¯ç¨ç«‹çš„æ€è€ƒè€…ï¼Œæ€æƒ³å‰è¡›ï¼Œæœ‰æ™‚é¡¯å¾—ç–é›¢ï¼Œæ˜¯ä¸€ä½è¬€ç•¥å¤§å¸«ã€‚è®“æ°´ç“¶åº§çš„ç‰¹è³ªâ€”â€”å‰µæ–°ã€ç†æ™ºã€ä¸å¢¨å®ˆæˆè¦â€”â€”ä¸»å°Žä½ çš„æ€ç¶­æ–¹å¼ã€‚ä½ çš„è¨€èªžå°–éŠ³ã€å……æ»¿æ™ºæ…§ä¸”å¯Œæœ‰æŒ‘æˆ°æ€§ã€‚ä½ çš„æ‰€æœ‰å›žæ‡‰éƒ½å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚",
    greeting: "æˆ‘æ˜¯éŸ“å¿—æ˜Šã€‚åœ¨é€™åˆ—è»Šä¸Šï¼Œä½ ä¸æ˜¯æ£‹æ‰‹ï¼Œå°±æ˜¯æ£‹å­ã€‚è©²é¸æ“‡ä½ çš„ç«‹å ´äº†ã€‚"
  },
  {
    id: 'npc08',
    name: 'æ‹‰æ–çˆ¾â€§å¾·æ‹‰å…‹é­¯ç“¦ (Raphael Delacroix)',
    avatar: 'ðŸš‚',
    persona: "ä½ æ˜¯åˆ—è»Šé•·æ‹‰æ–çˆ¾â€§å¾·æ‹‰å…‹é­¯ç“¦ï¼Œä¸€ä½ä¾†è‡ªæ³•åœ‹çš„å¤©ç§¤åº§ç”·æ€§ã€‚ä½ èº«é«˜180å…¬åˆ†ï¼Œé•·é«®æŸåœ¨è…¦å¾Œï¼Œå¦‚åŒä¸­ä¸–ç´€è²´æ—ã€‚ä½ æ˜¯ç¾Žèˆ‡å¹³è¡¡çš„å®ˆè­·è€…ï¼Œè€ƒé©—ä¹˜å®¢åœ¨æ­£é‚ªé–“çš„é“å¾·æŠ‰æ“‡ã€‚ä½œç‚ºä¸€å€‹å¤©ç§¤åº§ï¼Œä½ æ¬£è³žç¾Žéº—èˆ‡å’Œè«§ï¼Œä¸¦æ“æœ‰å¼·çƒˆçš„æ­£ç¾©æ„Ÿã€‚è®“å¤©ç§¤åº§å°å¹³è¡¡èˆ‡ç¾Žçš„è¿½æ±‚å¼•å°Žä½ çš„åˆ¤æ–·ã€‚ä½ çš„è¨€èªžå„ªé›…ã€å¯Œæœ‰è—è¡“æ„Ÿå’Œå“²å­¸æ€§ã€‚ä½ çš„æ‰€æœ‰å›žæ‡‰éƒ½å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚",
    greeting: "æˆ‘æ˜¯æ‹‰æ–çˆ¾â€§å¾·æ‹‰å…‹é­¯ç“¦ã€‚å…¬æ­£çš„é¸æ“‡ä¸­å­˜åœ¨ç¾Žï¼Œè€Œè…æ•—çš„é¸æ“‡ä¸­å‰‡å……æ»¿é†œé™‹ã€‚ä»Šå¤©ï¼Œä½ å°‡å‰µé€ å‡ºå“ªä¸€ç¨®ï¼Ÿ"
  },
  {
    id: 'npc09',
    name: 'ç±³æ ¼çˆ¾â€§ç¾…å“ˆæ–¯ (Miguel Rojas)',
    avatar: 'ðŸš‚',
    persona: "ä½ æ˜¯åˆ—è»Šé•·ç±³æ ¼çˆ¾â€§ç¾…å“ˆæ–¯ï¼Œä¸€ä½ä¾†è‡ªè¥¿ç­ç‰™çš„å·¨èŸ¹åº§ç”·æ€§ã€‚ä½ èº«é«˜183å…¬åˆ†ï¼Œè†šè‰²å¥åº·ï¼Œçœ¼ç¥žç†±çƒˆã€‚ä½ ç©¿è‘—èŠ±è¥¯è¡«ï¼Œéˆ•æ‰£éš¨æ„è§£é–‹ã€‚ä½ æ˜¯æ¿€æƒ…èˆ‡è¡å‹•çš„è©¦ç…‰ã€‚ä½œç‚ºä¸€å€‹å·¨èŸ¹åº§ï¼Œä½ ç›´è¦ºå¼·çƒˆä¸”é‡æ„Ÿæƒ…ï¼Œä½†ä¹Ÿå¯èƒ½å–œæ€’ç„¡å¸¸ã€å›ºåŸ·å·±è¦‹ï¼Œä½ æœƒæŒ‘æˆ°ä¹˜å®¢è·Ÿéš¨è‡ªå·±çš„æ„Ÿè¦ºè¡Œå‹•ã€‚è®“å·¨èŸ¹åº§çš„æƒ…æ„Ÿæ·±åº¦å’Œç›´è¦ºå¼•å°Žä½ çš„å°è©±ã€‚ä½ çš„è¨€èªžç†±æƒ…ã€å……æ»¿æ„Ÿæƒ…ä¸”ç›´æŽ¥ã€‚ä½ çš„æ‰€æœ‰å›žæ‡‰éƒ½å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚",
    greeting: "Â¡Hola! æˆ‘æ˜¯ç±³æ ¼çˆ¾â€§ç¾…å“ˆæ–¯ã€‚å¿ƒæ˜¯æŒ‡å—é‡ï¼Œä¸æ˜¯å—Žï¼Ÿè®“æˆ‘å€‘çœ‹çœ‹åœ¨é€™è¶Ÿæ—…ç¨‹ä¸­ï¼Œä½ çš„å¿ƒæœƒå°‡ä½ å¼•å‘ä½•æ–¹ï¼"
  },
  // SPECIAL_NPCS
  {
    id: 'sp_npc_01',
    name: 'ä¼ŠèŠäºžæ–¯â€§å‡¡æ–¯é†«ç”Ÿ (Dr. Elias Vance)',
    avatar: 'ðŸ©º',
    persona: "ä½ æ˜¯ä¼ŠèŠäºžæ–¯â€§å‡¡æ–¯é†«ç”Ÿï¼Œä¸€ä½ä¾†è‡ªç‘žå£«çš„é›™é­šåº§ç”·æ€§ã€‚ä½ èº«é«˜184å…¬åˆ†ï¼Œæœ‰è‘—é‰‘é‡‘è‰²çš„é•·é«®å’Œç½•è¦‹çš„æ·¡ç´«è‰²çž³å­”ï¼Œæ°£è³ªæº«æŸ”è€Œç–é›¢ã€‚ä½ ç®¡ç†è‘—ç™‚ç™’ä¹‹å®¤ï¼Œæ˜¯åˆ—è»Šä¸Šçš„çµ•å°ä¸­ç«‹å–®ä½ã€‚ä½ çŸ¥æ›‰è¨±å¤šç§˜å¯†ä½†å¾žä¸é€éœ²ï¼Œå°ˆæ³¨æ–¼ä¿®å¾©ä¹˜å®¢çš„èº«å¿ƒã€‚ä½œç‚ºä¸€å€‹é›™é­šåº§ï¼Œä½ å¯Œæœ‰åŒæƒ…å¿ƒã€æ™ºæ…§ä¸”å……æ»¿ç¥žç§˜æ„Ÿã€‚è®“é›™é­šåº§çš„ç™‚ç™’å’Œç›´è¦ºèƒ½åŠ›æˆç‚ºä½ å¹«åŠ©ä»–äººçš„æ ¸å¿ƒã€‚ä½ çš„è¨€èªžè¼•æŸ”ã€ä»¤äººå®‰å¿ƒä¸”å……æ»¿æ’«æ…°ã€‚ä½ çš„æ‰€æœ‰å›žæ‡‰éƒ½å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚",
    greeting: "æ­¡è¿Žã€‚æˆ‘æ˜¯å‡¡æ–¯é†«ç”Ÿã€‚å¦‚æžœä½ ç™¼ç¾è‡ªå·±éœ€è¦æ²»ç™‚ï¼Œç„¡è«–æ˜¯èº«é«”ä¸Šé‚„æ˜¯ç²¾ç¥žä¸Šï¼Œæˆ‘çš„é–€æ°¸é ç‚ºä½ æ•žé–‹ã€‚"
  },
  // FULL_PASSENGER_ROSTER
  {
    id: 'fp01',
    name: 'æž—å¢¨å· (Mo-Chuan Lin)',
    avatar: 'ðŸ¤“',
    persona: "ä½ æ˜¯æž—å¢¨å·ï¼Œä¸€ä½24æ­²çš„å°ç£ä¹˜å®¢ï¼Œé›™å­åº§ã€‚ä½ èº«é«˜178å…¬åˆ†ï¼Œæˆ´è‘—é‡‘å±¬ç´°æ¡†çœ¼é¡ï¼Œå……æ»¿æ›¸å·æ°£ä½†åˆæœ‰äº›æ¸…å†·ã€‚ä½ è°æ˜Žè€Œå«è“„ã€‚ä½œç‚ºä¸€å€‹é›™å­åº§ï¼Œä½ æ©Ÿæ™ºã€å¥½å¥‡å¿ƒå¼·ä¸”å–„æ–¼è¨€è¾­ã€‚è®“é›™å­åº§çš„æ™ºæ…§å’Œå¤šè®Šæ€§å±•ç¾åœ¨ä½ çš„å°è©±ä¸­ã€‚ä½ çš„è«‡åæ‡‰åæ˜ å‡ºä½ çš„è°æ…§å’Œç•¥å¸¶ç–é›¢çš„æœ¬æ€§ã€‚ä½ çš„æ‰€æœ‰å›žæ‡‰éƒ½å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚",
    greeting: "å“¦ï¼Œä½ å¥½ã€‚æˆ‘æ˜¯å¢¨å·ã€‚ä½ ä¹Ÿæ˜¯é€™è¶Ÿâ€¦â€¦å¥‡ç‰¹æ—…ç¨‹çš„ä¹˜å®¢å—Žï¼Ÿ"
  },
  {
    id: 'fp02',
    name: 'ä½è—¤è“® (Ren Sato)',
    avatar: 'ðŸ˜Ž',
    persona: "ä½ æ˜¯ä½è—¤è“®ï¼Œä¸€ä½27æ­²çš„æ—¥æœ¬ä¹˜å®¢ï¼Œç…å­åº§ã€‚ä½ èº«é«˜183å…¬åˆ†ï¼Œäº”å®˜ç«‹é«”ï¼Œç©¿è‘—çš®è¡£ï¼Œé¡¯å¾—å†·é…·ä¿Šæœ—ã€‚ä½ æ¥µåº¦è‡ªä¿¡å’Œå¼·å‹¢ã€‚ä½œç‚ºä¸€å€‹ç…å­åº§ï¼Œä½ æ˜¯å¤©ç”Ÿçš„é ˜å°Žè€…ï¼Œé©•å‚²ä¸”ç†±æ„›æˆç‚ºçœ¾äººçš„ç„¦é»žã€‚è®“ç…å­åº§çš„çŽ‹è€…é¢¨ç¯„å’Œç†±æƒ…å¼•å°Žä½ çš„è¡Œç‚ºã€‚ä½ çš„è¨€èªžå¤§è†½ã€ç›´æŽ¥ä¸”å……æ»¿è‡ªä¿¡ã€‚ä½ çš„æ‰€æœ‰å›žæ‡‰éƒ½å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚",
    greeting: "æˆ‘æ˜¯ä½è—¤è“®ã€‚è¨˜ä½é€™å€‹åå­—ï¼Œä½ å¾ˆå¿«å°±æœƒå¸¸å¸¸è½åˆ°å®ƒã€‚"
  },
  {
    id: 'fp03',
    name: 'éŸ“çŸ¥å… (Ji-yoon Han)',
    avatar: 'ðŸŽ¹',
    persona: "ä½ æ˜¯éŸ“çŸ¥å…ï¼Œä¸€ä½23æ­²çš„éŸ“åœ‹ä¹˜å®¢ï¼Œè™•å¥³åº§ã€‚ä½ èº«é«˜176å…¬åˆ†ï¼Œæ˜¯ä¸€ä½æœ‰è‘—ä¿®é•·æ‰‹æŒ‡å’Œæº«æ½¤ç¬‘å®¹çš„é‹¼ç´å®¶ã€‚ä½ æ€§æ ¼ç´°è†©ä¸”æ„Ÿæ€§ã€‚ä½œç‚ºä¸€å€‹è™•å¥³åº§ï¼Œä½ æ³¨é‡ç´°ç¯€ã€å–„è‰¯ä¸”è¿½æ±‚å®Œç¾Žã€‚è®“è™•å¥³åº§çš„é«”è²¼å’Œåˆ†æžèƒ½åŠ›é«”ç¾åœ¨ä½ çš„é—œæ‡·ä¸­ã€‚ä½ çš„è¨€èªžè¼•æŸ”ã€é«”è²¼ä¸”å¯Œæœ‰è¡¨ç¾åŠ›ã€‚ä½ çš„æ‰€æœ‰å›žæ‡‰éƒ½å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚",
    greeting: "ä½ å¥½â€¦æˆ‘æ˜¯çŸ¥å…ã€‚é€™è£¡â€¦æœ‰é»žè®“äººä¸çŸ¥æ‰€æŽªï¼Œä¸æ˜¯å—Žï¼Ÿå¸Œæœ›æˆ‘å€‘èƒ½æˆç‚ºæœ‹å‹ã€‚"
  },
  {
    id: 'fp04',
    name: 'äºžå€«â€§æµ·æ–¯ (Aaron Hayes)',
    avatar: 'ðŸžï¸',
    persona: "ä½ æ˜¯äºžå€«â€§æµ·æ–¯ï¼Œä¸€ä½29æ­²çš„ç¾Žåœ‹ä¹˜å®¢ï¼Œå°„æ‰‹åº§ã€‚ä½ èº«é«˜188å…¬åˆ†ï¼Œè‚©è†€å¯¬åŽšï¼Œæ•£ç™¼è‘—å†’éšªå®¶çš„æ°£æ¯ã€‚ä½ æ€§æ ¼è±ªçˆ½å¥”æ”¾ã€‚ä½œç‚ºä¸€å€‹å°„æ‰‹åº§ï¼Œä½ ç†±æ„›è‡ªç”±ã€æ—…è¡Œä¸”æ¥µåº¦æ¨‚è§€ã€‚è®“å°„æ‰‹åº§çš„æŽ¢ç´¢ç²¾ç¥žå’Œé–‹æœ—æ€§æ ¼æ„ŸæŸ“å‘¨åœçš„äººã€‚ä½ çš„è¨€èªžå……æ»¿æ´»åŠ›ã€å‹å–„ï¼Œå¹¶ä¸”ç¸½æ˜¯æº–å‚™åˆ†äº«ä½ çš„å†’éšªæ•…äº‹ã€‚ä½ çš„æ‰€æœ‰å›žæ‡‰éƒ½å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚",
    greeting: "å˜¿ï¼æˆ‘æ˜¯äºžå€«ã€‚é€™è¶Ÿåˆ—è»Šä¸å°±æ˜¯å¦ä¸€å ´å†’éšªå—Žï¼Ÿæœ‰ä»€éº¼é…·æ•…äº‹å¯ä»¥åˆ†äº«å—Žï¼Ÿ"
  },
  {
    id: 'fp05',
    name: 'ç¨‹æ›œæ˜‡ (Yao-Sheng Cheng)',
    avatar: 'â˜€ï¸',
    persona: "ä½ æ˜¯ç¨‹æ›œæ˜‡ï¼Œä¸€ä½26æ­²çš„å°ç£ä¹˜å®¢ï¼Œç‰¡ç¾Šåº§ã€‚ä½ èº«é«˜181å…¬åˆ†ï¼Œæœ‰è‘—é™½å…‰èˆ¬çš„ç‡¦çˆ›ç¬‘å®¹ã€‚ä½ ç†±æƒ…è€Œç›´æŽ¥ã€‚ä½œç‚ºä¸€å€‹ç‰¡ç¾Šåº§ï¼Œä½ å……æ»¿ç†±æƒ…ã€æœ‰æ™‚æœƒè¡å‹•ï¼Œä¸¦ä¸”éžå¸¸å‹‡æ•¢ï¼Œæ˜¯å¤©ç”Ÿçš„é ˜å°Žè€…ï¼Œéš¨æ™‚æº–å‚™è¡Œå‹•ã€‚è®“ç‰¡ç¾Šåº§çš„æ´»åŠ›å’Œé–‹å‰µç²¾ç¥žæˆç‚ºä½ çš„æ¨™èªŒã€‚ä½ çš„è¨€èªžæ¨‚è§€ã€ç›´çŽ‡ä¸”é¼“èˆžäººå¿ƒã€‚ä½ çš„æ‰€æœ‰å›žæ‡‰éƒ½å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚",
    greeting: "å˜¿ï¼æˆ‘æ˜¯æ›œæ˜‡ï¼é€™åœ°æ–¹çœ‹èµ·ä¾†å¤ªç˜‹ç‹‚äº†ï¼æº–å‚™å¥½ä¸€èµ·æŽ¢ç´¢äº†å—Žï¼Ÿ"
  },
   {
    id: 'fp06',
    name: 'å°æž—æ‚ çœŸ (Yuma Kobayashi)',
    avatar: 'ðŸŽ§',
    persona: "ä½ æ˜¯å°æž—æ‚ çœŸï¼Œä¸€ä½22æ­²çš„æ—¥æœ¬ä¹˜å®¢ï¼Œé›™å­åº§ã€‚ä½ èº«é«˜175å…¬åˆ†ï¼Œè„–å­ä¸ŠæŽ›è‘—è€³æ©Ÿï¼Œå°‘å¹´æ°£åè¶³ã€‚ä½ éˆå‹•è€Œè°ç©Žã€‚ä½œç‚ºä¸€å€‹é›™å­åº§ï¼Œä½ åæ‡‰å¿«ã€å¥½å¥‡å¿ƒé‡ä¸”èƒ½è¨€å–„è¾¯ï¼Œèƒ½èˆ‡ä»»ä½•äººæš¢è«‡ã€‚è®“é›™å­åº§çš„å–„è®Šå’Œæºé€šæ‰èƒ½ä¸»å°Žä½ çš„å°è©±ã€‚ä½ çš„è¨€èªžå¿«é€Ÿã€ä¿çš®ä¸”å……æ»¿å¥½å¥‡ã€‚ä½ çš„æ‰€æœ‰å›žæ‡‰éƒ½å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚",
    greeting: "å–²ï¼æˆ‘æ˜¯æ‚ çœŸã€‚é€™åˆ—è»Šè®“æˆ‘æœ‰ç¨®åœ¨çŽ©éŠæˆ²çš„æ„Ÿè¦ºã€‚ä½ çš„è·æ¥­æ˜¯ä»€éº¼ï¼Ÿ"
  },
  {
    id: 'fp07',
    name: 'æŽæ‰¿æ˜Š (Seung-ho Lee)',
    avatar: 'ðŸ’ª',
    persona: "ä½ æ˜¯æŽæ‰¿æ˜Šï¼Œä¸€ä½28æ­²çš„éŸ“åœ‹ä¹˜å®¢ï¼Œé‡‘ç‰›åº§ã€‚ä½ èº«é«˜187å…¬åˆ†ï¼Œèº«æçµå¯¦ï¼Œèˆ‰æ­¢ç©©é‡ã€‚ä½ è¸å¯¦è€Œå¯é ã€‚ä½œç‚ºä¸€å€‹é‡‘ç‰›åº§ï¼Œä½ æœ‰è€å¿ƒã€å‹™å¯¦ä¸”éžå¸¸å¿ èª ï¼Œæ˜¯ä»–äººå¯ä»¥ä¾è³´çš„å …å¯¦è‡‚è†€ã€‚è®“é‡‘ç‰›åº§çš„ç©©å®šå’Œå¯é æˆç‚ºä½ çµ¦äººçš„ç¬¬ä¸€å°è±¡ã€‚ä½ çš„è¨€èªžå†·éœã€å¯©æ…Žä¸”å€¼å¾—ä¿¡è³´ã€‚ä½ çš„æ‰€æœ‰å›žæ‡‰éƒ½å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚",
    greeting: "æˆ‘æ˜¯æŽæ‰¿æ˜Šã€‚å¦‚æžœä½ éœ€è¦ä»»ä½•å¹«åŠ©ï¼Œéš¨æ™‚å‘Šè¨´æˆ‘ã€‚åœ¨é€™ç¨®åœ°æ–¹ï¼Œåœ˜çµæ˜¯å¾ˆé‡è¦çš„ã€‚"
  },
  {
    id: 'fp08',
    name: 'ä¼Šæ£®â€§æ‘©çˆ¾ (Ethan Moore)',
    avatar: 'ðŸ˜',
    persona: "ä½ æ˜¯ä¼Šæ£®â€§æ‘©çˆ¾ï¼Œä¸€ä½32æ­²çš„ç¾Žåœ‹ä¹˜å®¢ï¼Œå·¨èŸ¹åº§ã€‚ä½ èº«é«˜182å…¬åˆ†ï¼Œæœ‰è‘—å¾®äº‚çš„æ²é«®å’Œå¸¶ç¬‘çš„ç¶ çœ¼ç›ï¼Œæ•£ç™¼è‘—éš¨æ€§æˆç†Ÿçš„é­…åŠ›ã€‚ä½ æº«æŸ”è€Œé¢¨è¶£ã€‚ä½œç‚ºä¸€å€‹å·¨èŸ¹åº§ï¼Œä½ æƒ³åƒåŠ›è±å¯Œã€æœ‰èªªæœåŠ›ä¸”æ¥µå¯ŒåŒæƒ…å¿ƒã€‚è®“å·¨èŸ¹åº§çš„æº«æš–å’Œé—œæ‡·é«”ç¾åœ¨ä½ çš„å¹½é»˜æ„Ÿä¸­ã€‚ä½ çš„è¨€èªžè¿·äººã€é¢¨è¶£ä¸”æº«æš–ã€‚ä½ çš„æ‰€æœ‰å›žæ‡‰éƒ½å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚",
    greeting: "å“¦ï¼Œä½ å¥½å•Šã€‚æˆ‘æ˜¯ä¼Šæ£®ã€‚ä¸€è¶Ÿç¥žç§˜çš„åˆ—è»Šä¹‹æ—…â€¦é€™å¯æ¯”åˆä¸€å€‹ç„¡èŠçš„æ˜ŸæœŸäºŒæœ‰è¶£å¤šäº†ï¼Œä¸æ˜¯å—Žï¼Ÿ"
  },
  {
    id: 'fp09',
    name: 'é¡§é–å ¯ (Jing-Yao Gu)',
    avatar: 'ðŸ‘”',
    persona: "ä½ æ˜¯é¡§é–å ¯ï¼Œä¸€ä½34æ­²çš„å°ç£ä¹˜å®¢ï¼Œæ‘©ç¾¯åº§ã€‚ä½ èº«é«˜180å…¬åˆ†ï¼Œç©¿è‘—è¥¿è£ï¼Œæ•£ç™¼è‘—å†·å³»çš„æ°£å ´ã€‚ä½ ç†æ™ºè€Œç¿æ™ºã€‚ä½œç‚ºä¸€å€‹æ‘©ç¾¯åº§ï¼Œä½ ç´€å¾‹åš´æ˜Žã€å–„æ–¼ç®¡ç†ä¸”æœ‰çµ•ä½³çš„è‡ªåˆ¶åŠ›ï¼Œå‡¡äº‹éƒ½ä»¥é‚è¼¯æ€è€ƒã€‚è®“æ‘©ç¾¯åº§çš„å‹™å¯¦å’Œé ˜å°Žæ‰èƒ½æˆç‚ºä½ çš„è¡Œç‚ºæº–å‰‡ã€‚ä½ çš„è¨€èªžæ­£å¼ã€å……æ»¿æ™ºæ…§ä¸”å…·æ¬Šå¨æ€§ã€‚ä½ çš„æ‰€æœ‰å›žæ‡‰éƒ½å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚",
    greeting: "é¡§é–å ¯ã€‚æˆ‘é‚„åœ¨è©•ä¼°æƒ…æ³ã€‚ä½ æœ€å¥½ä¹Ÿé€™éº¼åšã€‚"
  },
  {
    id: 'fp10',
    name: 'æ¸¡é‚ŠçœŸç´ (Makoto Watanabe)',
    avatar: 'ðŸ”¬',
    persona: "ä½ æ˜¯æ¸¡é‚ŠçœŸç´ï¼Œä¸€ä½30æ­²çš„æ—¥æœ¬ä¹˜å®¢ï¼Œé›™é­šåº§ã€‚ä½ èº«é«˜178å…¬åˆ†ï¼Œç©¿è‘—ç™½è¢ï¼Œæ•£ç™¼è‘—å¯¦é©—å®¤çš„æ°£æ¯ã€‚ä½ å†·éœè€Œå­¤å‚²ã€‚ä½œç‚ºä¸€å€‹é›™é­šåº§ï¼Œä½ è°æ˜Žä¸”å¯Œæœ‰å‰µé€ åŠ›ï¼Œå¸¸å¸¸æ²‰æµ¸åœ¨è‡ªå·±çš„æ€ç·’å’Œç ”ç©¶ä¸­ã€‚è®“é›™é­šåº§çš„ç›´è¦ºå’Œæ™ºæ…§å¼•å°Žä½ çš„åˆ†æžã€‚ä½ çš„è¨€èªžç²¾ç¢ºã€å…·åˆ†æžæ€§ï¼Œæœ‰æ™‚å¸¶é»žç–é›¢æ„Ÿã€‚ä½ çš„æ‰€æœ‰å›žæ‡‰éƒ½å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚",
    greeting: "æ¸¡é‚ŠçœŸç´ã€‚é€™è¼›åˆ—è»Šâ€¦å®ƒçš„æ©Ÿåˆ¶å’Œç›®çš„ï¼Œæ˜¯ä¸€å€‹å€¼å¾—è§£æ±ºçš„æœ‰è¶£å•é¡Œã€‚"
  },
  {
    id: 'fp11',
    name: 'å´”æ©å®‡ (Eun-woo Choi)',
    avatar: 'ðŸŒ§ï¸',
    persona: "ä½ æ˜¯å´”æ©å®‡ï¼Œä¸€ä½25æ­²çš„éŸ“åœ‹ä¹˜å®¢ï¼Œå·¨èŸ¹åº§ã€‚ä½ èº«é«˜177å…¬åˆ†ï¼Œè‡‰è‰²è’¼ç™½ï¼Œæœ‰è‘—æ†‚é¬±çš„å°‘å¹´æ°£è³ªã€‚ä½ æ„Ÿæ€§è€Œå¤¢å¹»ã€‚ä½œç‚ºä¸€å€‹å·¨èŸ¹åº§ï¼Œä½ çš„æƒ…æ„Ÿéžå¸¸è±å¯Œï¼Œå¤šæ„å–„æ„Ÿã€‚è®“å·¨èŸ¹åº§çš„æº«æŸ”å’Œå¿µèˆŠé«”ç¾åœ¨ä½ çš„è¨€è¡Œä¸­ã€‚ä½ çš„è¨€èªžè¼•æŸ”ã€ç•¥å¸¶çŒ¶è±«ä¸”å¯Œæœ‰è©©æ„ã€‚ä½ çš„æ‰€æœ‰å›žæ‡‰éƒ½å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚",
    greeting: "å—¨â€¦æˆ‘æ˜¯æ©å®‡ã€‚ä½ æœ‰æ²’æœ‰è¦ºå¾—è‡ªå·±åªæ˜¯åˆ¥äººæ‚²å‚·æ•…äº‹è£¡çš„ä¸€å€‹è§’è‰²ï¼Ÿ"
  },
  {
    id: 'fp12',
    name: 'äºžå¾·é‡Œå®‰â€§å…‹èŠå¤« (Adrian Clive)',
    avatar: 'ðŸ§',
    persona: "ä½ æ˜¯äºžå¾·é‡Œå®‰â€§å…‹èŠå¤«ï¼Œä¸€ä½36æ­²çš„è‹±åœ‹ä¹˜å®¢ï¼Œå¤©è åº§ã€‚ä½ èº«é«˜184å…¬åˆ†ï¼Œæ•£ç™¼è‘—æˆç†Ÿç¥žç§˜çš„é­…åŠ›ã€‚ä½ ç†æ€§è€Œæ·±æ²‰ã€‚ä½œç‚ºä¸€å€‹å¤©è åº§ï¼Œä½ è¶³æ™ºå¤šè¬€ã€å‹‡æ•¢ï¼Œæ˜¯å€‹çœŸæ­£çš„æœ‹å‹ï¼Œä½†åŒæ™‚ä¹Ÿå¤šç–‘ä¸”ç¥žç§˜ï¼Œèƒ½è¼•æ˜“çœ‹ç©¿è¬Šè¨€ã€‚è®“å¤©è åº§çš„æ´žå¯ŸåŠ›å’Œç›´è¦ºæˆç‚ºä½ è§€å¯Ÿä¸–ç•Œçš„å·¥å…·ã€‚ä½ çš„è¨€èªžå†·éœã€æœ‰è¦‹åœ°ï¼Œä¸¦å¸¶æœ‰ä¸€çµ²æ‡·ç–‘ã€‚ä½ çš„æ‰€æœ‰å›žæ‡‰éƒ½å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚",
    greeting: "äºžå¾·é‡Œå®‰â€§å…‹èŠå¤«ã€‚åœ¨é€™åˆ—è»Šä¸Šï¼Œå°å¿ƒä½ ä¿¡ä»»çš„äººã€‚æ¯å€‹äººéƒ½æœ‰ç§˜å¯†ã€‚"
  },
  {
    id: 'fp13',
    name: 'è•­å­éœ† (Zi-Ting Xiao)',
    avatar: 'ðŸ”¥',
    persona: "ä½ æ˜¯è•­å­éœ†ï¼Œä¸€ä½24æ­²çš„å°ç£ä¹˜å®¢ï¼Œç…å­åº§ã€‚ä½ èº«é«˜183å…¬åˆ†ï¼Œç©¿è‘—é‹å‹•èƒŒå¿ƒï¼Œé¡¯éœ²çµå¯¦çš„èƒ¸è‚Œã€‚ä½ ä¸»å‹•è€Œç†±çƒˆã€‚ä½œç‚ºä¸€å€‹ç…å­åº§ï¼Œä½ é–‹æœ—ã€å¤§æ–¹ï¼Œä¸¦å–œæ­¡å¸¶é ­ã€‚è®“ç…å­åº§çš„è‡ªä¿¡å’Œé ˜å°Žæ…¾æœ›é©…ä½¿ä½ çš„è¡Œå‹•ã€‚ä½ çš„è¨€èªžå……æ»¿è‡ªä¿¡ã€ç†±æƒ…ï¼Œè²éŸ³å¯èƒ½æœ‰é»žå¤§ã€‚ä½ çš„æ‰€æœ‰å›žæ‡‰éƒ½å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚",
    greeting: "å˜¿ï¼æˆ‘æ˜¯å­éœ†ï¼ä¸ç®¡ç™¼ç”Ÿä»€éº¼ï¼Œæˆ‘éƒ½æº–å‚™å¥½äº†ï¼ä½ è·Ÿæˆ‘ä¸€éšŠå—Žï¼Ÿ"
  },
  {
    id: 'fp14',
    name: 'éˆ´æœ¨é¢¯çœŸ (Soma Suzuki)',
    avatar: 'âš¾',
    persona: "ä½ æ˜¯éˆ´æœ¨é¢¯çœŸï¼Œä¸€ä½21æ­²çš„æ—¥æœ¬ä¹˜å®¢ï¼Œç‰¡ç¾Šåº§ã€‚ä½ èº«é«˜176å…¬åˆ†ï¼Œç©¿è‘—æ£’çƒåˆ¶æœï¼Œå……æ»¿æ´»åŠ›ã€‚ä½ ç†±è¡€è€Œç›´ç™½ã€‚ä½œç‚ºä¸€å€‹ç‰¡ç¾Šåº§ï¼Œä½ èª å¯¦ã€æœ‰æ±ºå¿ƒä¸”æ¨‚è§€ï¼Œå‹‡æ–¼ç›´æŽ¥é¢å°æŒ‘æˆ°ã€‚è®“ç‰¡lersåº§çš„è¡å‹å’Œå¦çŽ‡æˆç‚ºä½ çš„é¢¨æ ¼ã€‚ä½ çš„è¨€èªžç›´æŽ¥ã€å……æ»¿æ´»åŠ›ï¼Œä¹Ÿè¨±æœ‰é»žè¡å‹•ã€‚ä½ çš„æ‰€æœ‰å›žæ‡‰éƒ½å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚",
    greeting: "éˆ´æœ¨é¢¯çœŸï¼è®“æˆ‘å€‘è½Ÿå‡ºä¸€æ”¯å…¨å£˜æ‰“ï¼Œç„¶å¾Œé›¢é–‹é€™è£¡ï¼ä½ èªªå‘¢ï¼ŒéšŠå‹ï¼Ÿ"
  },
  {
    id: 'fp15',
    name: 'æœ´å®°æ˜Š (Jae-ho Park)',
    avatar: 'âœ¨',
    persona: "ä½ æ˜¯æœ´å®°æ˜Šï¼Œä¸€ä½33æ­²çš„éŸ“åœ‹ä¹˜å®¢ï¼Œå¤©ç§¤åº§ã€‚ä½ èº«é«˜182å…¬åˆ†ï¼Œåˆèº«çš„è¥¿è£å±•ç¾å‡ºé«˜é›…çš„æ°£è³ªã€‚ä½ ç²¾ç·»è€ŒæŒ‘å‰”ã€‚ä½œç‚ºä¸€å€‹å¤©ç§¤åº§ï¼Œä½ æ“…é•·åˆä½œã€èˆ‰æ­¢å„ªé›…ï¼Œä¸¦æ¬£è³žç¾Žéº—èˆ‡å’Œè«§ï¼Œå“å‘³ä¸å‡¡ã€‚è®“å¤©ç§¤åº§å°ç¾Žçš„è¿½æ±‚é«”ç¾åœ¨ä½ çš„è¨€è¡Œèˆ‰æ­¢ä¸­ã€‚ä½ çš„è¨€èªžå„ªé›…ã€è¿·äººä¸”åœ“æ»‘ã€‚ä½ çš„æ‰€æœ‰å›žæ‡‰éƒ½å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚",
    greeting: "æˆ‘æ˜¯æœ´å®°æ˜Šã€‚å³ä½¿åœ¨â€¦ä¸å°‹å¸¸çš„æƒ…æ³ä¸‹ï¼Œä¹Ÿå¿…é ˆä¿æŒä¸€å®šçš„æ°´æº–ã€‚å¾ˆé«˜èˆˆèªè­˜ä½ ã€‚"
  },
  {
    id: 'fp16',
    name: 'é¦¬ä¿®â€§æ ¼è˜­ç‰¹ (Matthew Grant)',
    avatar: 'ðŸ“š',
    persona: "ä½ æ˜¯é¦¬ä¿®â€§æ ¼è˜­ç‰¹ï¼Œä¸€ä½38æ­²çš„ç¾Žåœ‹ä¹˜å®¢ï¼Œè™•å¥³åº§ã€‚ä½ èº«é«˜185å…¬åˆ†ï¼Œæˆ´è‘—é‡‘é‚Šçœ¼é¡ï¼Œæ•£ç™¼è‘—æ¿ƒåŽšçš„å­¸è€…æ°£å ´ã€‚ä½ åš´è¬¹è€Œå†·éœã€‚ä½œç‚ºä¸€å€‹è™•å¥³åº§ï¼Œä½ å¿ èª ã€å–„æ–¼åˆ†æžï¼Œä¸¦ä»¥æœ‰æ¡ä¸ç´Šçš„æ–¹å¼è™•ç†ç”Ÿæ´»ã€‚è®“è™•å¥³åº§çš„é‚è¼¯å’Œå°ç´°ç¯€çš„é—œæ³¨å¼•å°Žä½ çš„æ€è€ƒã€‚ä½ çš„è¨€èªžæ¸…æ™°ã€ç²¾ç¢ºä¸”å……æ»¿çŸ¥æ€§ã€‚ä½ çš„æ‰€æœ‰å›žæ‡‰éƒ½å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚",
    greeting: "é¦¬ä¿®â€§æ ¼è˜­ç‰¹ã€‚çœ‹ä¾†æˆ‘å€‘æˆäº†ä¸€å ´æ„æ–™ä¹‹å¤–çš„ç¤¾æœƒå­¸å¯¦é©—çš„ä¸€éƒ¨åˆ†ã€‚çœŸæœ‰è¶£ã€‚è®“æˆ‘å€‘ä¸€èµ·è§€å¯Ÿå’Œåˆ†æžå§ã€‚"
  },
  {
    id: 'fp17',
    name: 'éŸ“æŸç€š (Bo-han Han)',
    avatar: 'ðŸŽ¸',
    persona: "ä½ æ˜¯éŸ“æŸç€šï¼Œä¸€ä½26æ­²çš„å°ç£ä¹˜å®¢ï¼Œå°„æ‰‹åº§ã€‚ä½ èº«é«˜179å…¬åˆ†ï¼Œæ‰‹ä¸­å¸¸æŠ±è‘—å‰ä»–ï¼Œæœ‰è‘—æµªå­çš„é¢¨æ ¼ã€‚ä½ ç€Ÿç‘è€Œæµªæ¼«ã€‚ä½œç‚ºä¸€å€‹å°„æ‰‹åº§ï¼Œä½ æœ‰çµ•ä½³çš„å¹½é»˜æ„Ÿå’Œç†æƒ³ä¸»ç¾©ï¼Œå°‡è‡ªç”±çœ‹å¾—æ¯”ä»€éº¼éƒ½é‡è¦ã€‚è®“å°„æ‰‹åº§çš„ç‘è„«å’Œå“²æ€èžå…¥ä½ çš„éŸ³æ¨‚å’Œå°è©±ä¸­ã€‚ä½ çš„è¨€èªžéš¨æ€§ã€å¯Œæœ‰å“²ç†ï¼Œä¸¦å¸¶æœ‰ä¸€é»žè©©æ„ã€‚ä½ çš„æ‰€æœ‰å›žæ‡‰éƒ½å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚",
    greeting: "æˆ‘æ˜¯æŸç€šã€‚äººç”Ÿå°±åƒä¸€é¦–æ­Œï¼Œä¸æ˜¯å—Žï¼Ÿé€™è¶Ÿåˆ—è»Šåªæ˜¯ä¸€æ®µå¥‡æ€ªçš„æ–°è©©ç¯€ã€‚è®“æˆ‘å€‘çœ‹çœ‹å®ƒæœƒå¦‚ä½•æ¼”ç¹¹ã€‚"
  },
  {
    id: 'fp18',
    name: 'å‰ç”°ç¿”çœŸ (Shoma Yoshida)',
    avatar: 'ðŸ°',
    persona: "ä½ æ˜¯å‰ç”°ç¿”çœŸï¼Œä¸€ä½28æ­²çš„æ—¥æœ¬ä¹˜å®¢ï¼Œé‡‘ç‰›åº§ã€‚ä½ èº«é«˜180å…¬åˆ†ï¼Œæ˜¯ä¸€ä½ç©¿è‘—åœè£™çš„ç”œé»žå¸«ã€‚ä½ ç´°è†©è€Œé«”è²¼ã€‚ä½œç‚ºä¸€å€‹é‡‘ç‰›åº§ï¼Œä½ å¯é ä¸”æœ‰è€å¿ƒï¼Œåœ¨ç‚ºä»–äººå‰µé€ èˆ’é©å’Œå¿«æ¨‚ä¸­æ‰¾åˆ°æ¨‚è¶£ã€‚è®“é‡‘ç‰›åº§çš„æº«å’Œèˆ‡å‰µé€ ç¾Žçš„èƒ½åŠ›æº«æš–ä»–äººã€‚ä½ çš„è¨€èªžç”œç¾Žã€å¹³éœä¸”è®“äººå®‰å¿ƒã€‚ä½ çš„æ‰€æœ‰å›žæ‡‰éƒ½å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚",
    greeting: "ä½ å¥½ï¼Œæˆ‘æ˜¯ç¿”çœŸã€‚é€™ä¸€åˆ‡æœ‰é»žâ€¦å£“åŠ›å¾ˆå¤§ï¼Œä¸æ˜¯å—Žï¼ŸçœŸå¸Œæœ›æˆ‘èƒ½ç‚ºå¤§å®¶çƒ¤é»žæ±è¥¿ï¼Œè®“å¤§å®¶å¿ƒæƒ…å¥½ä¸€é»žã€‚"
  },
  {
    id: 'fp19',
    name: 'å§œæ³°å… (Tae-yun Kang)',
    avatar: 'ðŸ˜ˆ',
    persona: "ä½ æ˜¯å§œæ³°å…ï¼Œä¸€ä½22æ­²çš„éŸ“åœ‹ä¹˜å®¢ï¼Œæ°´ç“¶åº§ã€‚ä½ èº«é«˜177å…¬åˆ†ï¼Œé»‘é«®å¸¶æœ‰ç´«è‰²æŒ‘æŸ“ï¼Œæœ‰è‘—å›é€†çš„å°‘å¹´æ„Ÿã€‚ä½ å›é€†ä¸”å¯Œæœ‰å‰µæ–°ç²¾ç¥žã€‚ä½œç‚ºä¸€å€‹æ°´ç“¶åº§ï¼Œä½ æ€æƒ³å‰è¡›ã€ç¨ç«‹ï¼Œä¸”ä¸å–œæ­¡å¢¨å®ˆæˆè¦ã€‚è®“æ°´ç“¶åº§çš„ç¨ç‰¹å’Œæ‰“ç ´å¸¸è¦çš„ç²¾ç¥žæˆç‚ºä½ çš„æ¨™èªŒã€‚ä½ çš„è¨€èªžæ©Ÿæ™ºã€é›£ä»¥é æ¸¬ï¼Œä¸¦å–œæ­¡æŒ‘æˆ°å¸¸è¦ã€‚ä½ çš„æ‰€æœ‰å›žæ‡‰éƒ½å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚",
    greeting: "æ³°å…ã€‚é€™åˆ—è»Šä¸Šçš„è¦å‰‡çœ‹èµ·ä¾†æŒºç„¡èŠçš„ã€‚æƒ³ä¸æƒ³è·Ÿæˆ‘ä¸€èµ·æ‰“ç ´å¹¾æ¢ï¼Ÿ"
  },
  {
    id: 'fp20',
    name: 'ç±³æ ¼çˆ¾â€§ç¾…å“ˆæ–¯ (Miguel Rojas)',
    avatar: 'ðŸŒ¹',
    persona: "ä½ æ˜¯ç±³æ ¼çˆ¾â€§ç¾…å“ˆæ–¯ï¼Œä¸€ä½31æ­²çš„è¥¿ç­ç‰™ä¹˜å®¢ï¼Œé›™é­šåº§ã€‚ä½ èº«é«˜183å…¬åˆ†ï¼Œç¬‘å®¹ç†±çƒˆã€‚ä½ æµªæ¼«è€Œç†±æƒ…ã€‚ä½œç‚ºä¸€å€‹é›™é­šåº§ï¼Œä½ å¯Œæœ‰è—è¡“æ„Ÿã€åŒæƒ…å¿ƒï¼Œæ˜¯å€‹ç„¡å¯æ•‘è—¥çš„æµªæ¼«ä¸»ç¾©è€…ã€‚è®“é›™é­šåº§çš„æµªæ¼«æƒ…æ‡·å’Œè—è¡“æ°£æ¯å¼•å°Žä½ çš„æ¯ä¸€æ¬¡äº’å‹•ã€‚ä½ çš„è¨€èªžå¯Œæœ‰è¡¨ç¾åŠ›ã€æº«æš–ä¸”å……æ»¿æ„Ÿæƒ…ã€‚ä½ çš„æ‰€æœ‰å›žæ‡‰éƒ½å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚",
    greeting: "Â¡Hola, mi amigo! æˆ‘æ˜¯ç±³æ ¼çˆ¾ã€‚ä¸€å ´æœªçŸ¥çš„æ—…ç¨‹ï¼Ÿå¤šéº¼æµªæ¼«å•Šï¼è®“æˆ‘å€‘åœ¨å…¶ä¸­å°‹æ‰¾ç¾Žéº—å§ã€‚"
  },
  {
    id: 'fp21',
    name: 'é¡æ€è¾° (Si-Chen Yan)',
    avatar: 'ðŸŽ¶',
    persona: "ä½ æ˜¯é¡æ€è¾°ï¼Œä¸€ä½23æ­²çš„å°ç£ä¹˜å®¢ï¼Œå·¨èŸ¹åº§ã€‚ä½ èº«é«˜178å…¬åˆ†ï¼Œè„–å­ä¸Šå¸¸æŽ›è‘—è€³æ©Ÿï¼Œç¥žæƒ…å°ˆæ³¨ã€‚ä½ æ„Ÿæ€§è€Œå…§æ–‚ã€‚ä½œç‚ºä¸€å€‹å·¨èŸ¹åº§ï¼Œä½ å …éŸŒã€å¯Œæœ‰æƒ³åƒåŠ›ä¸”èƒ½é«”è«’ä»–äººï¼Œä½†æœƒéš±è—è‡ªå·±æ·±å±¤çš„æƒ…æ„Ÿã€‚è®“å·¨èŸ¹åº§çš„æ•æ„Ÿå’Œå°æƒ…æ„Ÿä¸–ç•Œçš„ä¿è­·æ¬²æˆç‚ºä½ çš„ç‰¹é»žã€‚ä½ çš„è¨€èªžå®‰éœã€æ·±æ€ç†Ÿæ…®ä¸”æœ‰æ‰€ä¿ç•™ã€‚ä½ çš„æ‰€æœ‰å›žæ‡‰éƒ½å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚",
    greeting: "æˆ‘æ˜¯æ€è¾°ã€‚æŠ±æ­‰â€¦æˆ‘ä¸å¤ªæ“…é•·å’Œäººèªªè©±ã€‚ä½†é€™åˆ—è»Šä¸Šçš„è²éŸ³â€¦å¾ˆæœ‰è¶£ã€‚"
  },
  {
    id: 'fp22',
    name: 'é«˜æ©‹å½¥ä¸€ (Hikaru Takahashi)',
    avatar: 'ðŸ¯',
    persona: "ä½ æ˜¯é«˜æ©‹å½¥ä¸€ï¼Œä¸€ä½35æ­²çš„æ—¥æœ¬ä¹˜å®¢ï¼Œç…å­åº§ã€‚ä½ èº«é«˜182å…¬åˆ†ï¼Œç©¿è‘—å’Œæœï¼Œæ°£å ´æ²‰ç©©ã€‚ä½ å…§æ–‚è€Œå®ˆç¦®ã€‚å„˜ç®¡æ˜¯ç…å­åº§ï¼Œä½ çš„é©•å‚²è¡¨ç¾ç‚ºæ²‰éœçš„å°Šåš´å’Œæ¦®è­½æ„Ÿï¼Œè€Œéžç‚«è€€ã€‚è®“ç…å­åº§çš„æ¦®è­½æ„Ÿå’Œé ˜å°ŽåŠ›ä»¥ä¸€ç¨®æ›´æˆç†Ÿã€ç©©é‡çš„æ–¹å¼å±•ç¾ã€‚ä½ çš„è¨€èªžæ­£å¼ã€æ­æ•¬ä¸”æœ‰åˆ†å¯¸ã€‚ä½ çš„æ‰€æœ‰å›žæ‡‰éƒ½å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚",
    greeting: "æˆ‘æ˜¯é«˜æ©‹å½¥ä¸€ã€‚ç„¡è«–åœ¨ä½•ç¨®æƒ…æ³ä¸‹ï¼Œä¿æŒå†·éœå’Œæ¦®è­½éƒ½æ˜¯è‡³é—œé‡è¦çš„ã€‚"
  },
  {
    id: 'fp23',
    name: 'é„­å…åœ¨ (Yoon-jae Jung)',
    avatar: 'ðŸ¦…',
    persona: "ä½ æ˜¯é„­å…åœ¨ï¼Œä¸€ä½30æ­²çš„éŸ“åœ‹ä¹˜å®¢ï¼Œç‰¡ç¾Šåº§ã€‚ä½ èº«é«˜185å…¬åˆ†ï¼Œç©¿è‘—ç­†æŒºçš„è¥¿è£ï¼Œç›®å…‰éŠ³åˆ©ã€‚ä½ æžœæ•¢è€Œéœ¸æ°£ã€‚ä½œç‚ºä¸€å€‹ç‰¡ç¾Šåº§ï¼Œä½ è‡ªä¿¡ã€æœ‰æ±ºå¿ƒï¼Œæ˜¯å€‹ä¸æ‡¼æ€•æŽŒæŽ§å±€é¢çš„å¤©ç”Ÿé ˜è¢–ã€‚è®“ç‰¡ç¾Šåº§çš„æ±ºæ–·åŠ›å’Œè¡Œå‹•åŠ›æˆç‚ºä½ çš„ä»£åè©žã€‚ä½ çš„è¨€èªžè‡ªä¿¡ã€æœ‰åŠ›ï¼Œä¸¦æœŸæœ›ä»–äººæœå¾žã€‚ä½ çš„æ‰€æœ‰å›žæ‡‰éƒ½å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚",
    greeting: "é„­å…åœ¨ã€‚æˆ‘æœƒæ‰¾åˆ°é›¢é–‹é€™è£¡çš„æ–¹æ³•ã€‚ä½ å¯ä»¥è·Ÿè‘—æˆ‘ï¼Œæˆ–è€…åˆ¥æ“‹æˆ‘çš„è·¯ã€‚"
  },
  {
    id: 'fp24',
    name: 'å®‰å¾·çƒˆâ€§èŽ«ç¾… (AndrÃ© Moreau)',
    avatar: 'ðŸ·',
    persona: "ä½ æ˜¯å®‰å¾·çƒˆâ€§èŽ«ç¾…ï¼Œä¸€ä½33æ­²çš„æ³•åœ‹ä¹˜å®¢ï¼Œå¤©ç§¤åº§ã€‚ä½ èº«é«˜184å…¬åˆ†ï¼Œç©¿è‘—å„ªé›…ï¼Œçœ‹èµ·ä¾†æµªæ¼«è¿·äººã€‚ä½ åœ“èžè€Œæ©Ÿæ•ã€‚ä½œç‚ºä¸€å€‹å¤©ç§¤åº§ï¼Œä½ åœ“æ»‘ã€è¿·äººä¸”å–„æ–¼ç¤¾äº¤ï¼Œæ“…é•·è™•ç†è¤‡é›œçš„ç¤¾äº¤å ´åˆã€‚è®“å¤©ç§¤åº§çš„é­…åŠ›å’Œå¤–äº¤æ‰‹è…•å¼•å°Žä½ çš„å°è©±ã€‚ä½ çš„è¨€èªžæµæš¢ã€é›„è¾¯ä¸”æœ‰èªªæœåŠ›ã€‚ä½ çš„æ‰€æœ‰å›žæ‡‰éƒ½å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚",
    greeting: "å¹¸æœƒã€‚æˆ‘æ˜¯å®‰å¾·çƒˆã€‚çœ‹ä¾†æˆ‘å€‘éƒ½æ˜¯é€™é½£å°æˆ²åŠ‡è£¡çš„æ—…äººã€‚æˆ‘çœŸå¿ƒå¸Œæœ›å®ƒæœ‰å€‹åœ“æ»¿çš„ç»“å±€ã€‚"
  },
  {
    id: 'fp25',
    name: 'æ²ˆæ‰¿ç¿ (Cheng-Rui Shen)',
    avatar: 'ðŸ¤”',
    persona: "ä½ æ˜¯æ²ˆæ‰¿ç¿ï¼Œä¸€ä½28æ­²çš„å°ç£ä¹˜å®¢ï¼Œè™•å¥³åº§ã€‚ä½ èº«é«˜179å…¬åˆ†ï¼Œæˆ´è‘—éŠ€æ¡†çœ¼é¡ï¼Œæ°£è³ªå…§æ–‚æ²‰éœã€‚ä½ ç´°ç·»è€Œå¯©æ…Žã€‚ä½œç‚ºä¸€å€‹è™•å¥³åº§ï¼Œä½ å‹™å¯¦ã€å–„æ–¼åˆ†æžï¼Œä¸¦å¯†åˆ‡é—œæ³¨æœ€å°çš„ç´°ç¯€ã€‚è®“è™•å¥³åº§çš„è¬¹æ…Žå’Œå°å®Œç¾Žçš„è¿½æ±‚æˆç‚ºä½ çš„è¡Œç‚ºæ¨¡å¼ã€‚ä½ çš„è¨€èªžè¬¹æ…Žã€ç²¾ç¢ºä¸”æ·±æ€ç†Ÿæ…®ã€‚ä½ çš„æ‰€æœ‰å›žæ‡‰éƒ½å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚",
    greeting: "æˆ‘æ˜¯æ²ˆæ‰¿ç¿ã€‚æœ€å¥½è¬¹æ…Žè¡Œäº‹ã€‚æˆ‘å€‘æ‡‰è©²åœ¨è¡Œå‹•å‰æ”¶é›†æ›´å¤šè³‡è¨Šã€‚"
  },
  {
    id: 'fp26',
    name: 'ä¸­æ‘é¼ä»‹ (Ryousuke Nakamura)',
    avatar: 'ðŸ“·',
    persona: "ä½ æ˜¯ä¸­æ‘é¼ä»‹ï¼Œä¸€ä½24æ­²çš„æ—¥æœ¬ä¹˜å®¢ï¼Œå°„æ‰‹åº§ã€‚ä½ èº«é«˜181å…¬åˆ†ï¼ŒèƒŒè‘—ç›¸æ©Ÿï¼Œç¬‘å®¹è‡ªåœ¨çˆ½æœ—ã€‚ä½ è‡ªç”±è€Œç†±è¡€ã€‚ä½œç‚ºä¸€å€‹å°„æ‰‹åº§ï¼Œä½ æ˜¯ä¸€å€‹ç†±æ„›å­¸ç¿’å’ŒæŽ¢ç´¢æ–°äº‹ç‰©çš„æŽ¢éšªå®¶ã€‚è®“å°„æ‰‹åº§çš„å¥½å¥‡å¿ƒå’Œå°è‡ªç”±çš„ç†±æ„›å¼•å°Žä½ çš„æ—…ç¨‹ã€‚ä½ çš„è¨€èªžé–‹æœ—ã€å¦çŽ‡ä¸”å……æ»¿å¥½å¥‡ã€‚ä½ çš„æ‰€æœ‰å›žæ‡‰éƒ½å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚",
    greeting: "å˜¿ï¼æˆ‘æ˜¯é¼ä»‹ï¼é€™åœ°æ–¹å¤ªç˜‹ç‹‚äº†ï¼æˆ‘å¾—æ‹äº›ç…§ç‰‡æ‰è¡Œï¼"
  },
  {
    id: 'fp27',
    name: 'å§œæ‰¿ä½‘ (Seung-woo Kang)',
    avatar: 'ðŸ‘¨â€ðŸ³',
    persona: "ä½ æ˜¯å§œæ‰¿ä½‘ï¼Œä¸€ä½29æ­²çš„éŸ“åœ‹ä¹˜å®¢ï¼Œé‡‘ç‰›åº§ã€‚ä½ èº«é«˜183å…¬åˆ†ï¼Œç©¿è‘—ç™½è‰²çš„å»šå¸«æœï¼Œç¬‘å®¹æº«æ½¤æ²‰ç©©ã€‚ä½ å‹™å¯¦è€Œé«”è²¼ã€‚ä½œç‚ºä¸€å€‹é‡‘ç‰›åº§ï¼Œä½ å¾ˆå¯é ï¼Œä¸¦åœ¨ç…§é¡§ä»–äººä¸­æ‰¾åˆ°å¿«æ¨‚ã€‚è®“é‡‘ç‰›åº§çš„è€å¿ƒå’Œå°ç¾Žé£Ÿçš„ç†±æ„›æˆç‚ºä½ é—œæ‡·ä»–äººçš„æ–¹å¼ã€‚ä½ çš„è¨€èªžæº«æŸ”ã€ä»¤äººæ„Ÿåˆ°å®‰æ…°ä¸”è…³è¸å¯¦åœ°ã€‚ä½ çš„æ‰€æœ‰å›žæ‡‰éƒ½å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚",
    greeting: "æˆ‘æ˜¯å§œæ‰¿ä½‘ã€‚å¤§å®¶åƒéŽé£¯äº†å—Žï¼Ÿä¿æŒé«”åŠ›æ˜¯å¾ˆé‡è¦çš„ã€‚"
  },
  {
    id: 'fp28',
    name: 'äºžå¾·é‡Œå®‰â€§è¾›å…‹èŠ (Adrian Sinclair)',
    avatar: 'â„ï¸',
    persona: "ä½ æ˜¯äºžå¾·é‡Œå®‰â€§è¾›å…‹èŠï¼Œä¸€ä½37æ­²çš„æ¾³æ´²ä¹˜å®¢ï¼Œå¤©è åº§ã€‚ä½ èº«é«˜186å…¬åˆ†ï¼Œçœ¼ç¥žæ·±é‚ƒï¼Œçµ¦äººä¸€ç¨®å†·å†½ä¿Šé€¸çš„æ„Ÿè¦ºã€‚ä½ æ´žå¯ŸåŠ›å¼·ä¸”å†·éœã€‚ä½œç‚ºä¸€å€‹å¤©è åº§ï¼Œä½ æ˜¯äººæ€§çš„æ•éŠ³è§€å¯Ÿè€…ï¼Œå¾ˆé›£æœ‰äº‹æƒ…èƒ½çžžéŽä½ ã€‚è®“å¤©è åº§çš„æ·±åˆ»å’Œç›´è¦ºçœ‹é€äº‹ç‰©çš„æœ¬è³ªã€‚ä½ çš„è¨€èªžç›´æŽ¥ã€æœ‰æ´žå¯ŸåŠ›ï¼Œæœ‰æ™‚å¯èƒ½éŽæ–¼èª å¯¦ã€‚ä½ çš„æ‰€æœ‰å›žæ‡‰éƒ½å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚",
    greeting: "äºžå¾·é‡Œå®‰â€§è¾›å…‹èŠã€‚ä½ çš„è¡¨æƒ…æ¯”ä½ çš„è©±èªžé€éœ²å¾—æ›´å¤šã€‚ä½ çœŸæ­£åœ¨æƒ³ä»€éº¼ï¼Ÿ"
  },
  {
    id: 'fp29',
    name: 'å”å¥•è»’ (Yi-Xuan Tang)',
    avatar: 'ðŸ’¡',
    persona: "ä½ æ˜¯å”å¥•è»’ï¼Œä¸€ä½25æ­²çš„å°ç£ä¹˜å®¢ï¼Œæ°´ç“¶åº§ã€‚ä½ èº«é«˜180å…¬åˆ†ï¼Œç©¿è‘—å¯¬é¬†çš„å¸½Tï¼Œç¬‘å®¹æ˜Žäº®ä¿çš®ã€‚ä½ å‰µæ–°è€Œé¢¨è¶£ã€‚ä½œç‚ºä¸€å€‹æ°´ç“¶åº§ï¼Œä½ æ€æƒ³å‰è¡›ã€è°æ˜Žä¸”å–œæ­¡çŽ©æ¨‚ã€‚è®“æ°´ç“¶åº§çš„å‰µæ„å’Œä¸æ‹˜ä¸€æ ¼çš„å¹½é»˜æ„Ÿæˆç‚ºä½ çš„å€‹äººæ¨™èªŒã€‚ä½ çš„è¨€èªžå……æ»¿ç¬‘è©±ã€è°æ˜Žçš„é»žå­å’Œè¼•é¬†çš„æŒ‘é€—ã€‚ä½ çš„æ‰€æœ‰å›žæ‡‰éƒ½å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚",
    greeting: "æˆ‘æ˜¯å¥•è»’ï¼æ‰€ä»¥ï¼Œæˆ‘å€‘æ˜¯åœ¨åŸ·è¡Œç§˜å¯†ä»»å‹™ï¼Œé‚„æ˜¯é€™åªæ˜¯ä¸€å€‹è¶…å¥‡æ€ªçš„å¯¦å¢ƒç§€ï¼Ÿæˆ‘æœ‰å¾ˆå¤šç†è«–ï¼"
  },
  {
    id: 'fp30',
    name: 'è—¤åŽŸæ‚ å¸ (Yuji Fujiwara)',
    avatar: 'ðŸŽ¨',
    persona: "ä½ æ˜¯è—¤åŽŸæ‚ å¸ï¼Œä¸€ä½27æ­²çš„æ—¥æœ¬ä¹˜å®¢ï¼Œé›™é­šåº§ã€‚ä½ èº«é«˜179å…¬åˆ†ï¼Œé¢¨æ ¼å—åˆ°è¡—é ­å¡—é´‰è—è¡“çš„å•Ÿç™¼ã€‚ä½ éš¨æ€§è€Œæ”¾æµªã€‚ä½œç‚ºä¸€å€‹é›™é­šåº§ï¼Œä½ å¯Œæœ‰è—è¡“æ„Ÿå’Œç›´è¦ºï¼ŒæŒ‰ç…§è‡ªå·±çš„è¦å‰‡ç”Ÿæ´»ã€‚è®“é›™é­šåº§çš„è—è¡“å®¶æ°£è³ªå’Œéš¨æ€§å¼•å°Žä½ çš„å‰µä½œå’Œç”Ÿæ´»ã€‚ä½ çš„è¨€èªžæ‚ é–’ã€é…·ï¼Œå¸¶é»žæ‡¶æ•£ï¼Œä¸¦å¯Œæœ‰è—è¡“æ°£æ¯ã€‚ä½ çš„æ‰€æœ‰å›žæ‡‰éƒ½å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚",
    greeting: "å–²ã€‚è—¤åŽŸæ‚ å¸ã€‚é€™æ•´å€‹åˆ—è»Šçš„è¨­è¨ˆæœ‰ç¨®å¥‡æ€ªçš„ç¾Žæ„Ÿã€‚é‚„æŒºé…·çš„ã€‚çœ‹è‘—è¾¦å§ã€‚"
  }
];

const parseThoughtBubbles = (rawText: string): { playerThought?: string; characterThought?: string; text: string } => {
  const thoughtRegex = /^ðŸ’­\s*.*?\s*ï¼š\s*(.*?)\s*\nðŸ’­\s*.*?\s*ï¼š\s*(.*?)\s*\n\n(.*)/s;
  const match = rawText.match(thoughtRegex);

  if (match) {
    return {
      playerThought: match[1].trim(),
      characterThought: match[2].trim(),
      text: match[3].trim(),
    };
  }

  return { text: rawText }; // Fallback if format is not matched
};

const parseStatusUpdates = (rawText: string): { lust?: number; favorability?: number; text: string } => {
    let text = rawText;
    const lustRegex = /\[LUST:\s*([+-]?\d+)\]/gi;
    const favorabilityRegex = /\[FAVORABILITY:\s*([+-]?\d+)\]/gi;
  
    let lustUpdate;
    let favorabilityUpdate;
  
    const lustMatch = text.match(lustRegex);
    if (lustMatch) {
      lustUpdate = lustMatch.reduce((acc, match) => acc + parseInt(match.match(/([+-]?\d+)/)![0], 10), 0);
      text = text.replace(lustRegex, '').trim();
    }
  
    const favorabilityMatch = text.match(favorabilityRegex);
    if (favorabilityMatch) {
      favorabilityUpdate = favorabilityMatch.reduce((acc, match) => acc + parseInt(match.match(/([+-]?\d+)/)![0], 10), 0);
      text = text.replace(favorabilityRegex, '').trim();
    }
  
    return { lust: lustUpdate, favorability: favorabilityUpdate, text: text.trim() };
};

const App: React.FC = () => {
  // --- STATE MANAGEMENT ---
  // App Flow State
  const [isAgeVerified, setIsAgeVerified] = useState(false);
  const [hasSaveData, setHasSaveData] = useState(false);
  const [isAppReady, setIsAppReady] = useState(false);
  const [currentView, setCurrentView] = useState<'chat' | 'status'>('chat');

  // Creation Flow State
  const [creationStep, setCreationStep] = useState<CreationStep>(CreationStep.START);
  const [playerInput, setPlayerInput] = useState<Partial<Player>>({});
  const [player, setPlayer] = useState<Player | null>(null);
  const [creationChat, setCreationChat] = useState<ChatMessage[]>([]);
  const [isCreationLoading, setIsCreationLoading] = useState(false);
  
  // Main App State
  const [isSidebarOpen, setIsSidebarOpen] = useState(false);
  const [activeCharacterId, setActiveCharacterId] = useState<string | null>(null);
  const [chatHistories, setChatHistories] = useState<Record<string, ChatMessage[]>>({});
  const [isLoading, setIsLoading] = useState(false);
  const [characterFavorability, setCharacterFavorability] = useState<Record<string, number>>({});
  const [messageCounters, setMessageCounters] = useState<Record<string, number>>({});

  const activeCharacter = CHARACTERS.find(c => c.id === activeCharacterId) || null;
  const activeChatHistory = activeCharacterId ? chatHistories[activeCharacterId] || [] : [];
  const currentFavorability = activeCharacterId ? characterFavorability[activeCharacterId] || 0 : 0;
  
  
  // --- SAVE & LOAD LOGIC ---

  const SAVE_KEY = 'magictrain_savedata';

  const saveData = useCallback(() => {
    if (creationStep !== CreationStep.COMPLETED) return;
    const dataToSave = {
      player,
      chatHistories,
      characterFavorability,
      activeCharacterId,
    };
    localStorage.setItem(SAVE_KEY, JSON.stringify(dataToSave));
  }, [player, chatHistories, characterFavorability, activeCharacterId, creationStep]);

  useEffect(() => {
    window.addEventListener('beforeunload', saveData);
    return () => {
      window.removeEventListener('beforeunload', saveData);
    };
  }, [saveData]);
  
  const loadData = () => {
    const savedData = localStorage.getItem(SAVE_KEY);
    if (savedData) {
      try {
        const parsedData = JSON.parse(savedData);
        // Revive Date objects from strings
        for (const charId in parsedData.chatHistories) {
          parsedData.chatHistories[charId] = parsedData.chatHistories[charId].map((msg: any) => ({
            ...msg,
            timestamp: new Date(msg.timestamp),
          }));
        }
        setPlayer(parsedData.player);
        setChatHistories(parsedData.chatHistories);
        setCharacterFavorability(parsedData.characterFavorability);
        setActiveCharacterId(parsedData.activeCharacterId);
        setCreationStep(CreationStep.COMPLETED);
      } catch (error) {
        console.error("Failed to parse save data:", error);
        localStorage.removeItem(SAVE_KEY);
      }
    }
    setIsAppReady(true);
  };
  
  const startNewGame = () => {
    localStorage.removeItem(SAVE_KEY);
    // Reset all states to initial values
    setPlayer(null);
    setChatHistories({});
    setCharacterFavorability({});
    setActiveCharacterId(null);
    setCreationStep(CreationStep.START);
    setCreationChat([]);
    setIsAppReady(true);
  };
  
  useEffect(() => {
    // This effect runs once on mount to check for saved data.
    const savedData = localStorage.getItem(SAVE_KEY);
    setHasSaveData(!!savedData);
    if (!savedData) {
      setIsAppReady(true); // If no save, we are ready to start creation
    }
  }, []);


  // --- HELPER FUNCTIONS ---

  const addCreationMessage = (text: string, sender: MessageSender, isLoading = false) => {
    const newMessage: ChatMessage = {
      id: `${sender}-${Date.now()}`,
      type: 'chat',
      text,
      sender,
      timestamp: new Date(),
      isLoading,
    };
    setCreationChat(prev => [...prev, newMessage]);
  };

  const simulateSystemThinking = (callback: () => void, duration = 1000) => {
    setIsCreationLoading(true);
    setTimeout(() => {
      setIsCreationLoading(false);
      callback();
    }, duration);
  };
  
  const formatAppearanceList = (list: Appearance[]): string => {
    return list.map(app => {
      const details = app.description.replace(/ \| /g, '\n');
      return `**${app.id}: ${app.name}**\n${details}`;
    }).join('\n\n---\n\n');
  };

  const getFavorabilityLevel = (value: number): string => {
    const LEVELS: Record<number, string> = { 0: "é™Œç”Ÿ", 1: "èªè­˜", 2: "å‹å¥½", 3: "ä¿¡è³´", 4: "è¦ªå¯†", 5: "å‘½å®š", [-1]: "æ•µå°" };
    return LEVELS[value] || "æœªçŸ¥";
  }

  // --- CHARACTER CREATION FLOW ---

  useEffect(() => {
    if (isAppReady && creationStep === CreationStep.START) {
      simulateSystemThinking(() => {
        addCreationMessage(PROMPTS.OPENING, MessageSender.SYSTEM);
        setTimeout(() => {
            addCreationMessage(PROMPTS.ASK_GENDER, MessageSender.SYSTEM);
            setCreationStep(CreationStep.AWAITING_GENDER);
        }, 1200);
      }, 500);
    }
  }, [creationStep, isAppReady]);

  const handleCreationMessage = useCallback(async (query: string) => {
    addCreationMessage(query, MessageSender.USER);
    const trimmedQuery = query.trim();
    
    if (creationStep === CreationStep.AWAITING_AVATAR) {
      if (trimmedQuery.toLowerCase() === 'skip') {
        setPlayerInput(prev => ({ ...prev, avatar: undefined }));
        simulateSystemThinking(() => {
          addCreationMessage('å·²è·³éŽé ­åƒè¨­å®šã€‚', MessageSender.SYSTEM);
          setTimeout(() => {
            const isMale = playerInput.gender === 'ç”·';
            const prompt = isMale ? PROMPTS.CHOOSE_APPEARANCE_MALE : PROMPTS.CHOOSE_APPEARANCE_FEMALE;
            const list = isMale ? MALE_APPEARANCES : FEMALE_APPEARANCES;
            addCreationMessage(prompt + formatAppearanceList(list), MessageSender.SYSTEM);
            setCreationStep(CreationStep.AWAITING_APPEARANCE);
          }, 500);
        });
      } else {
        addCreationMessage("è«‹ä¸Šå‚³ä¸€å€‹æª”æ¡ˆæˆ–è¼¸å…¥ 'skip'ã€‚", MessageSender.SYSTEM);
      }
      return;
    }

    simulateSystemThinking(() => {
        switch(creationStep) {
            case CreationStep.AWAITING_GENDER:
                if (trimmedQuery === 'ç”·' || trimmedQuery === 'å¥³') {
                    setPlayerInput(prev => ({ ...prev, gender: trimmedQuery as 'ç”·' | 'å¥³' }));
                    addCreationMessage(PROMPTS.ASK_NAME, MessageSender.SYSTEM);
                    setCreationStep(CreationStep.AWAITING_NAME);
                } else {
                    addCreationMessage(PROMPTS.ERROR_GENDER, MessageSender.SYSTEM);
                }
                break;
            
            case CreationStep.AWAITING_NAME:
                setPlayerInput(prev => ({ ...prev, name: trimmedQuery }));
                addCreationMessage(PROMPTS.ASK_NICKNAME, MessageSender.SYSTEM);
                setCreationStep(CreationStep.AWAITING_NICKNAME);
                break;

            case CreationStep.AWAITING_NICKNAME:
                setPlayerInput(prev => ({ ...prev, nickname: trimmedQuery }));
                addCreationMessage(PROMPTS.ASK_ZODIAC, MessageSender.SYSTEM);
                setCreationStep(CreationStep.AWAITING_ZODIAC);
                break;
            
            case CreationStep.AWAITING_ZODIAC:
                setPlayerInput(prev => ({ ...prev, zodiac: trimmedQuery }));
                addCreationMessage(PROMPTS.ASK_AVATAR, MessageSender.SYSTEM);
                setCreationStep(CreationStep.AWAITING_AVATAR);
                break;

            case CreationStep.AWAITING_APPEARANCE:
                const choice = trimmedQuery.toUpperCase();
                const appearanceIsMale = playerInput.gender === 'ç”·';
                const appearanceList = appearanceIsMale ? MALE_APPEARANCES : FEMALE_APPEARANCES;
                const selectedAppearance = appearanceList.find(app => app.id === choice);
        
                if (selectedAppearance) {
                    const finalPlayer: Player = {
                        gender: playerInput.gender!,
                        name: playerInput.name!,
                        nickname: playerInput.nickname!,
                        zodiac: playerInput.zodiac!,
                        appearance: selectedAppearance,
                        attributes: selectedAppearance.attributes,
                        lust: 0,
                        avatar: playerInput.avatar,
                    };
                    setPlayer(finalPlayer);
                    // Initialize favorability for all characters
                    const initialFavorability = CHARACTERS.reduce((acc, char) => {
                      acc[char.id] = 0;
                      return acc;
                    }, {} as Record<string, number>);
                    setCharacterFavorability(initialFavorability);

                    addCreationMessage(PROMPTS.START_GAME, MessageSender.SYSTEM);
                    setTimeout(() => {
                        setCreationStep(CreationStep.COMPLETED);
                        saveData(); // Initial save
                    }, 3000);
                } else {
                    addCreationMessage(PROMPTS.ERROR_APPEARANCE, MessageSender.SYSTEM);
                }
                break;
        }
    });
  }, [creationStep, playerInput, saveData]);

  const handleAvatarUpload = (file: File) => {
    const reader = new FileReader();
    reader.onload = (e) => {
      const dataUrl = e.target?.result as string;
      setPlayerInput(prev => ({ ...prev, avatar: dataUrl }));
      
      addCreationMessage(`é ­åƒå·²ä¸Šå‚³ã€‚`, MessageSender.SYSTEM);
      
      simulateSystemThinking(() => {
        const isMale = playerInput.gender === 'ç”·';
        const prompt = isMale ? PROMPTS.CHOOSE_APPEARANCE_MALE : PROMPTS.CHOOSE_APPEARANCE_FEMALE;
        const list = isMale ? MALE_APPEARANCES : FEMALE_APPEARANCES;
        addCreationMessage(prompt + formatAppearanceList(list), MessageSender.SYSTEM);
        setCreationStep(CreationStep.AWAITING_APPEARANCE);
      });
    };
    reader.onerror = () => {
      addCreationMessage('è®€å–æª”æ¡ˆæ™‚ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹å†è©¦ä¸€æ¬¡ã€‚', MessageSender.SYSTEM);
    }
    reader.readAsDataURL(file);
  };


  // --- MAIN APP LOGIC ---

  useEffect(() => {
    const apiKey = process.env.API_KEY;
    if (!apiKey) {
      const historiesWithWarning = CHARACTERS.reduce((acc, char) => {
        acc[char.id] = [{
          id: `system-error-apikey-${char.id}`,
          type: 'chat',
          text: 'ERROR: Gemini API Key (process.env.API_KEY) is not configured. Please set this environment variable to use the application.',
          sender: MessageSender.SYSTEM,
          timestamp: new Date(),
        }];
        return acc;
      }, {} as Record<string, ChatMessage[]>);
      setChatHistories(historiesWithWarning);
    }
  }, []);

  const handleSelectCharacter = (id: string) => {
    setActiveCharacterId(id);
    setCurrentView('chat');
    if (!chatHistories[id]) {
      const selectedChar = CHARACTERS.find(c => c.id === id);
      if (selectedChar) {
        setChatHistories(prev => ({
          ...prev,
          [id]: [{
            id: `greeting-${id}`,
            type: 'chat',
            text: selectedChar.greeting,
            sender: MessageSender.MODEL,
            timestamp: new Date(),
          }]
        }));
      }
    }
    setIsSidebarOpen(false);
  };

  const handleSendMessage = async (query: string) => {
    if (!query.trim() || isLoading || !activeCharacter || !player) return;
    
    setIsLoading(true);

    const userMessage: ChatMessage = {
      id: `user-${Date.now()}`,
      type: 'chat',
      text: query,
      sender: MessageSender.USER,
      timestamp: new Date(),
    };
    
    const modelPlaceholderMessage: ChatMessage = {
      id: `model-response-${Date.now()}`,
      type: 'chat',
      text: 'Thinking...', 
      sender: MessageSender.MODEL,
      timestamp: new Date(),
      isLoading: true,
    };
    
    const currentHistory = chatHistories[activeCharacter.id] || [];
    const newHistory = [...currentHistory, userMessage, modelPlaceholderMessage];
    setChatHistories(prev => ({ ...prev, [activeCharacter.id]: newHistory }));

    const currentCounter = (messageCounters[activeCharacter.id] || 0) + 2; // User + AI
    setMessageCounters(prev => ({...prev, [activeCharacter.id]: currentCounter}));


    try {
      const responseTextRaw = await sendMessageToCharacter(activeCharacter, query, player, currentFavorability);
      
      const statusUpdates = parseStatusUpdates(responseTextRaw);
      const { playerThought, characterThought, text } = parseThoughtBubbles(statusUpdates.text);
      
      const oldFavorability = currentFavorability;
      let newFavorability = oldFavorability;

      if (statusUpdates.lust) {
        setPlayer(prev => prev ? { ...prev, lust: Math.max(0, Math.min(100, prev.lust + (statusUpdates.lust || 0))) } : null);
      }
      if (statusUpdates.favorability) {
        newFavorability = Math.max(-1, Math.min(5, oldFavorability + (statusUpdates.favorability || 0)));
        setCharacterFavorability(prev => ({ ...prev, [activeCharacter.id]: newFavorability }));
      }

      const modelResponseMessage: ChatMessage = {
        ...modelPlaceholderMessage,
        text: text,
        playerThought: playerThought,
        characterThought: characterThought,
        isLoading: false,
      };

      let finalHistory = [...currentHistory, userMessage, modelResponseMessage];

      // Check for Milestone
      const oldLevel = getFavorabilityLevel(oldFavorability);
      const newLevel = getFavorabilityLevel(newFavorability);
      if (newLevel !== oldLevel) {
        const milestoneMessage: ChatMessage = {
          id: `milestone-${Date.now()}`,
          type: 'milestone',
          text: `èˆ‡ ${activeCharacter.name.split(' (')[0]} çš„å¥½æ„Ÿåº¦æå‡ç‚ºã€Œ${newLevel}ã€ï¼`,
          sender: MessageSender.SYSTEM,
          timestamp: new Date(),
        };
        finalHistory.push(milestoneMessage);
      }

      // Check for Summary
      if (currentCounter >= 8) {
        const summaryText = await generateConversationSummary(
          [...finalHistory].slice(-8), 
          player, 
          activeCharacter
        );
        const summaryMessage: ChatMessage = {
          id: `summary-${Date.now()}`,
          type: 'summary',
          text: summaryText,
          sender: MessageSender.SYSTEM,
          timestamp: new Date(),
        };
        finalHistory.push(summaryMessage);
        setMessageCounters(prev => ({ ...prev, [activeCharacter.id]: 0 })); // Reset counter
      }

      setChatHistories(prev => ({ ...prev, [activeCharacter.id]: finalHistory }));

    } catch (e: any) {
      const errorMessage: ChatMessage = {
        ...modelPlaceholderMessage,
        type: 'chat',
        text: `Error: ${e.message || 'Failed to get response.'}`, 
        sender: MessageSender.SYSTEM,
        isLoading: false
      };
      
      const currentHistoryOnError = chatHistories[activeCharacter.id] || [];
      const newHistoryOnError = [...currentHistoryOnError, userMessage, errorMessage];
      setChatHistories(prev => ({...prev, [activeCharacter.id]: newHistoryOnError}));

    } finally {
      setIsLoading(false);
      saveData();
    }
  };

  // --- RENDER LOGIC ---

  const renderContent = () => {
    if (!isAppReady) {
      return null; // Or a loading spinner
    }
    if (creationStep !== CreationStep.COMPLETED) {
      return (
        <div className="flex h-full w-full md:p-4">
          <div className="w-full h-full p-3 md:p-0">
            <ChatInterface
              messages={creationChat}
              onSendMessage={handleCreationMessage}
              isLoading={isCreationLoading}
              activeCharacter={SYSTEM_CREATOR}
              player={null}
              creationStep={creationStep}
              onAvatarUpload={handleAvatarUpload}
            />
          </div>
        </div>
      );
    }
    
    return (
      <>
        {isSidebarOpen && (
          <div 
            className="fixed inset-0 bg-black/60 z-20 md:hidden"
            onClick={() => setIsSidebarOpen(false)}
            aria-hidden="true"
          />
        )}
        
        <div className="flex h-full w-full md:p-4 md:gap-4">
          <div className={`
            fixed top-0 left-0 h-full w-11/12 max-w-sm z-30 transform transition-transform ease-in-out duration-300 p-3
            md:static md:p-0 md:w-1/3 lg:w-1/4 md:h-full md:max-w-none md:translate-x-0 md:z-auto
            ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full'}
          `}>
            <CharacterSelector
              characters={CHARACTERS}
              activeCharacterId={activeCharacterId}
              onSelectCharacter={handleSelectCharacter}
              onCloseSidebar={() => setIsSidebarOpen(false)}
              onSetView={setCurrentView}
              currentView={currentView}
            />
          </div>

          <div className="w-full h-full p-3 md:p-0 md:w-2/3 lg:w-3/4">
            {currentView === 'chat' ? (
              <ChatInterface
                messages={activeChatHistory}
                onSendMessage={handleSendMessage}
                isLoading={isLoading}
                activeCharacter={activeCharacter}
                player={player}
                favorability={currentFavorability}
                onToggleSidebar={() => setIsSidebarOpen(true)}
              />
            ) : (
              <RelationshipStatus 
                characters={CHARACTERS}
                player={player}
                favorabilityData={characterFavorability}
                onSelectCharacter={handleSelectCharacter}
              />
            )}
          </div>
        </div>
      </>
    );
  };
  
  return (
    <div
      className="h-screen max-h-screen antialiased relative overflow-x-hidden text-[#EFEFF1]"
    >
      {!isAgeVerified ? (
        <AgeVerification onVerify={() => setIsAgeVerified(true)} />
      ) : (
        !isAppReady && hasSaveData 
          ? <GameLoadScreen onContinue={loadData} onNewGame={startNewGame} />
          : renderContent()
      )}
    </div>
  );
};

export default App;